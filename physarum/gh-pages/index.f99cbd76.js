!function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};
/*@license twgl.js 4.19.1 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
  Available via the MIT license.
  see: http://github.com/greggman/twgl.js for details*/let t=Float32Array;function n(e,n,r){const i=new t(3);return e&&(i[0]=e),n&&(i[1]=n),r&&(i[2]=r),i}function r(e,n,r){return(r=r||new t(3))[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r}function i(e,n,r){return(r=r||new t(3))[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r}let o=Float32Array;function a(e){return(e=e||new o(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function s(e,t){t=t||new o(16);const n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],d=e[8],f=e[9],h=e[10],p=e[11],m=e[12],_=e[13],b=e[14],g=e[15],v=h*g,y=b*p,x=u*g,w=b*c,E=u*p,A=h*c,C=i*g,S=b*a,F=i*p,P=h*a,k=i*c,T=u*a,O=d*_,L=m*f,I=s*_,R=m*l,D=s*f,z=d*l,N=n*_,B=m*r,M=n*f,U=d*r,j=n*l,G=s*r,H=v*l+w*f+E*_-(y*l+x*f+A*_),V=y*r+C*f+P*_-(v*r+S*f+F*_),W=x*r+S*l+k*_-(w*r+C*l+T*_),q=A*r+F*l+T*f-(E*r+P*l+k*f),X=1/(n*H+s*V+d*W+m*q);return t[0]=X*H,t[1]=X*V,t[2]=X*W,t[3]=X*q,t[4]=X*(y*s+x*d+A*m-(v*s+w*d+E*m)),t[5]=X*(v*n+S*d+F*m-(y*n+C*d+P*m)),t[6]=X*(w*n+C*s+T*m-(x*n+S*s+k*m)),t[7]=X*(E*n+P*s+k*d-(A*n+F*s+T*d)),t[8]=X*(O*c+R*p+D*g-(L*c+I*p+z*g)),t[9]=X*(L*a+N*p+U*g-(O*a+B*p+M*g)),t[10]=X*(I*a+B*c+j*g-(R*a+N*c+G*g)),t[11]=X*(z*a+M*c+G*p-(D*a+U*c+j*p)),t[12]=X*(I*h+z*b+L*u-(D*b+O*u+R*h)),t[13]=X*(M*b+O*i+B*h-(N*h+U*b+L*i)),t[14]=X*(N*u+G*b+R*i-(j*b+I*i+B*u)),t[15]=X*(j*h+D*i+U*u-(M*u+G*h+z*i)),t}function l(e,t,r){r=r||n();const i=t[0],o=t[1],a=t[2],s=i*e[3]+o*e[7]+a*e[11]+e[15];return r[0]=(i*e[0]+o*e[4]+a*e[8]+e[12])/s,r[1]=(i*e[1]+o*e[5]+a*e[9]+e[13])/s,r[2]=(i*e[2]+o*e[6]+a*e[10]+e[14])/s,r}function u(e,t,r){r=r||n();const i=t[0],o=t[1],a=t[2];return r[0]=i*e[0]+o*e[4]+a*e[8],r[1]=i*e[1]+o*e[5]+a*e[9],r[2]=i*e[2]+o*e[6]+a*e[10],r}const c=5120,d=5121,f=5122,h=5123,p=5124,m=5125,_=5126,b={};{const e=b;e[5120]=Int8Array,e[5121]=Uint8Array,e[5122]=Int16Array,e[5123]=Uint16Array,e[5124]=Int32Array,e[5125]=Uint32Array,e[5126]=Float32Array,e[32819]=Uint16Array,e[32820]=Uint16Array,e[33635]=Uint16Array,e[5131]=Uint16Array,e[33640]=Uint32Array,e[35899]=Uint32Array,e[35902]=Uint32Array,e[36269]=Uint32Array,e[34042]=Uint32Array}function g(e){if(e instanceof Int8Array)return c;if(e instanceof Uint8Array)return d;if(e instanceof Uint8ClampedArray)return d;if(e instanceof Int16Array)return f;if(e instanceof Uint16Array)return h;if(e instanceof Int32Array)return p;if(e instanceof Uint32Array)return m;if(e instanceof Float32Array)return _;throw new Error("unsupported typed array type")}function v(e){if(e===Int8Array)return c;if(e===Uint8Array)return d;if(e===Uint8ClampedArray)return d;if(e===Int16Array)return f;if(e===Uint16Array)return h;if(e===Int32Array)return p;if(e===Uint32Array)return m;if(e===Float32Array)return _;throw new Error("unsupported typed array type")}function y(e){const t=b[e];if(!t)throw new Error("unknown gl type");return t}const x="undefined"!=typeof SharedArrayBuffer?function(e){return e&&e.buffer&&(e.buffer instanceof ArrayBuffer||e.buffer instanceof SharedArrayBuffer)}:function(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer};function w(...e){console.error(...e)}function E(...e){console.warn(...e)}function A(e,t){return"undefined"!=typeof WebGLRenderbuffer&&t instanceof WebGLRenderbuffer}function C(e,t){return"undefined"!=typeof WebGLTexture&&t instanceof WebGLTexture}const S=34962,F={attribPrefix:""};function P(e,t,n,r,i){e.bindBuffer(t,n),e.bufferData(t,r,i||35044)}function k(e,t,n,r){if(i=t,"undefined"!=typeof WebGLBuffer&&i instanceof WebGLBuffer)return t;var i;n=n||S;const o=e.createBuffer();return P(e,n,o,t,r),o}function T(e){return"indices"===e}function O(e){return e.length?e:e.data}const L=/coord|texture/i,I=/color|colour/i;function R(e,t){let n;if(n=L.test(e)?2:I.test(e)?4:3,t%n>0)throw new Error(`Can not guess numComponents for attribute '${e}'. Tried ${n} but ${t} values is not evenly divisible by ${n}. You should specify it.`);return n}function D(e,t){return e.numComponents||e.size||R(t,O(e).length)}function z(e,t){if(x(e))return e;if(x(e.data))return e.data;Array.isArray(e)&&(e={data:e});let n=e.type;return n||(n=T(t)?Uint16Array:Float32Array),new n(e.data)}function N(e,t){const n={};return Object.keys(t).forEach((function(r){if(!T(r)){const o=t[r],a=o.attrib||o.name||o.attribName||F.attribPrefix+r;if(o.value){if(!Array.isArray(o.value)&&!x(o.value))throw new Error("array.value is not array or typedarray");n[a]={value:o.value}}else{let t,s,l,u;if(o.buffer&&o.buffer instanceof WebGLBuffer)t=o.buffer,u=o.numComponents||o.size,s=o.type,l=o.normalize;else if("number"==typeof o||"number"==typeof o.data){const n=o.data||o,a=o.type||Float32Array,c=n*a.BYTES_PER_ELEMENT;s=v(a),l=void 0!==o.normalize?o.normalize:(i=a)===Int8Array||i===Uint8Array,u=o.numComponents||o.size||R(r,n),t=e.createBuffer(),e.bindBuffer(S,t),e.bufferData(S,c,o.drawType||35044)}else{const n=z(o,r);t=k(e,n,void 0,o.drawType),s=g(n),l=void 0!==o.normalize?o.normalize:function(e){return e instanceof Int8Array||e instanceof Uint8Array}(n),u=D(o,r)}n[a]={buffer:t,numComponents:u,type:s,normalize:l,stride:o.stride||0,offset:o.offset||0,divisor:void 0===o.divisor?void 0:o.divisor,drawType:o.drawType}}}var i})),e.bindBuffer(S,null),n}const B=["position","positions","a_position"];function M(e,t,n){const r=N(e,t),i=Object.assign({},n||{});i.attribs=Object.assign({},n?n.attribs:{},r);const o=t.indices;if(o){const t=z(o,"indices");i.indices=k(e,t,34963),i.numElements=t.length,i.elementType=g(t)}else i.numElements||(i.numElements=function(e,t){let n,r;for(r=0;r<B.length&&(n=B[r],!(n in t))&&(n=F.attribPrefix+n,!(n in t));++r);r===B.length&&(n=Object.keys(t)[0]);const i=t[n];e.bindBuffer(S,i.buffer);const o=e.getBufferParameter(S,34660);var a;e.bindBuffer(S,null);const s=o/(5120===(a=i.type)||5121===a?1:5122===a||5123===a?2:5124===a||5125===a||5126===a?4:0),l=i.numComponents||i.size,u=s/l;if(u%1!=0)throw new Error(`numComponents ${l} not correct for length ${length}`);return u}(e,i.attribs));return i}function U(e,t,n){const r="indices"===n?34963:S;return k(e,z(t,n),r)}function j(e,t){const n={};return Object.keys(t).forEach((function(r){n[r]=U(e,t[r],r)})),t.indices?(n.numElements=t.indices.length,n.elementType=g(z(t.indices))):n.numElements=function(e){let t,n;for(n=0;n<B.length&&(t=B[n],!(t in e));++n);n===B.length&&(t=Object.keys(e)[0]);const r=e[t],i=O(r).length,o=D(r,t),a=i/o;if(i%o>0)throw new Error(`numComponents ${o} not correct for length ${i}`);return a}(t),n}function G(e,t){let n=0;return e.push=function(){for(let t=0;t<arguments.length;++t){const r=arguments[t];if(r instanceof Array||x(r))for(let t=0;t<r.length;++t)e[n++]=r[t];else e[n++]=r}},e.reset=function(e){n=e||0},e.numComponents=t,Object.defineProperty(e,"numElements",{get:function(){return this.length/this.numComponents|0}}),e}function H(e,t,n){return G(new(n||Float32Array)(e*t),e)}function V(e,t,n){const r=e.length,i=new Float32Array(3);for(let o=0;o<r;o+=3)n(t,[e[o],e[o+1],e[o+2]],i),e[o]=i[0],e[o+1]=i[1],e[o+2]=i[2]}function W(e,t,r){r=r||n();const i=t[0],o=t[1],a=t[2];return r[0]=i*e[0]+o*e[1]+a*e[2],r[1]=i*e[4]+o*e[5]+a*e[6],r[2]=i*e[8]+o*e[9]+a*e[10],r}function q(e,t){return V(e,t,u),e}function X(e,t){return V(e,s(t),W),e}function K(e,t){return V(e,t,l),e}function Y(e,t){return Object.keys(e).forEach((function(n){const r=e[n];n.indexOf("pos")>=0?K(r,t):n.indexOf("tan")>=0||n.indexOf("binorm")>=0?q(r,t):n.indexOf("norm")>=0&&X(r,t)})),e}function Q(e,t,n){return e=e||2,{position:{numComponents:2,data:[(t=t||0)+-1*(e*=.5),(n=n||0)+-1*e,t+1*e,n+-1*e,t+-1*e,n+1*e,t+1*e,n+1*e]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function Z(e,t,n,r,i){e=e||1,t=t||1,n=n||1,r=r||1,i=i||a();const o=(n+1)*(r+1),s=H(3,o),l=H(3,o),u=H(2,o);for(let i=0;i<=r;i++)for(let o=0;o<=n;o++){const a=o/n,c=i/r;s.push(e*a-.5*e,0,t*c-.5*t),l.push(0,1,0),u.push(a,c)}const c=n+1,d=H(3,n*r*2,Uint16Array);for(let e=0;e<r;e++)for(let t=0;t<n;t++)d.push((e+0)*c+t,(e+1)*c+t,(e+0)*c+t+1),d.push((e+1)*c+t,(e+1)*c+t+1,(e+0)*c+t+1);return Y({position:s,normal:l,texcoord:u,indices:d},i)}function $(e,t,n,r,i,o,a){if(t<=0||n<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");r=r||0,o=o||0;const s=(i=i||Math.PI)-r,l=(a=a||2*Math.PI)-o,u=(t+1)*(n+1),c=H(3,u),d=H(3,u),f=H(2,u);for(let i=0;i<=n;i++)for(let a=0;a<=t;a++){const u=a/t,h=i/n,p=l*u+o,m=s*h+r,_=Math.sin(p),b=Math.cos(p),g=Math.sin(m),v=b*g,y=Math.cos(m),x=_*g;c.push(e*v,e*y,e*x),d.push(v,y,x),f.push(1-u,h)}const h=t+1,p=H(3,t*n*2,Uint16Array);for(let e=0;e<t;e++)for(let t=0;t<n;t++)p.push((t+0)*h+e,(t+0)*h+e+1,(t+1)*h+e),p.push((t+1)*h+e,(t+0)*h+e+1,(t+1)*h+e+1);return{position:c,normal:d,texcoord:f,indices:p}}const J=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function ee(e){const t=(e=e||1)/2,n=[[-t,-t,-t],[+t,-t,-t],[-t,+t,-t],[+t,+t,-t],[-t,-t,+t],[+t,-t,+t],[-t,+t,+t],[+t,+t,+t]],r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],i=[[1,0],[0,0],[0,1],[1,1]],o=H(3,24),a=H(3,24),s=H(2,24),l=H(3,12,Uint16Array);for(let e=0;e<6;++e){const t=J[e];for(let l=0;l<4;++l){const u=n[t[l]],c=r[e],d=i[l];o.push(u),a.push(c),s.push(d)}const u=4*e;l.push(u+0,u+1,u+2),l.push(u+0,u+2,u+3)}return{position:o,normal:a,texcoord:s,indices:l}}function te(e,t,n,r,i,o,a){if(r<3)throw new Error("radialSubdivisions must be 3 or greater");if(i<1)throw new Error("verticalSubdivisions must be 1 or greater");const s=void 0===o||o,l=void 0===a||a,u=(s?2:0)+(l?2:0),c=(r+1)*(i+1+u),d=H(3,c),f=H(3,c),h=H(2,c),p=H(3,r*(i+u/2)*2,Uint16Array),m=r+1,_=Math.atan2(e-t,n),b=Math.cos(_),g=Math.sin(_),v=i+(l?2:0);for(let o=s?-2:0;o<=v;++o){let a,s=o/i,l=n*s;o<0?(l=0,s=1,a=e):o>i?(l=n,s=1,a=t):a=e+o/i*(t-e),-2!==o&&o!==i+2||(a=0,s=0),l-=n/2;for(let e=0;e<m;++e){const t=Math.sin(e*Math.PI*2/r),n=Math.cos(e*Math.PI*2/r);d.push(t*a,l,n*a),o<0?f.push(0,-1,0):o>i?f.push(0,1,0):0===a?f.push(0,0,0):f.push(t*b,g,n*b),h.push(e/r,1-s)}}for(let e=0;e<i+u;++e)if(!(1===e&&s||e===i+u-2&&l))for(let t=0;t<r;++t)p.push(m*(e+0)+0+t,m*(e+0)+1+t,m*(e+1)+1+t),p.push(m*(e+0)+0+t,m*(e+1)+1+t,m*(e+1)+0+t);return{position:d,normal:f,texcoord:h,indices:p}}function ne(e,t){t=t||[];const n=[];for(let r=0;r<e.length;r+=4){const i=e[r],o=e.slice(r+1,r+4);o.push.apply(o,t);for(let e=0;e<i;++e)n.push.apply(n,o)}return n}function re(){const e=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],t=ne([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),n=ne([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),r=e.length/3,i={position:H(3,r),texcoord:H(2,r),normal:H(3,r),color:H(4,r,Uint8Array),indices:H(3,r/3,Uint16Array)};i.position.push(e),i.texcoord.push([.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0]),i.normal.push(t),i.color.push(n);for(let e=0;e<r;++e)i.indices.push(e);return i}function ie(e,t,n,o,a,s,l){if(a<=0)throw new Error("subdivisionDown must be > 0");const u=(l=l||1)-(s=s||0),c=2*(a+1)*4,d=H(3,c),f=H(3,c),h=H(2,c);function p(e,t,n){return e+(t-e)*n}function m(t,n,l,c,m,_){for(let b=0;b<=a;b++){const g=n/1,v=b/a,y=2*(g-.5),x=(s+v*u)*Math.PI,w=Math.sin(x),E=Math.cos(x),A=p(e,t,w),C=y*o,S=E*e,F=w*A;d.push(C,S,F);const P=r(i([0,w,E],l),c);f.push(P),h.push(g*m+_,v)}}for(let e=0;e<2;e++){const r=2*(e/1-.5);m(t,e,[1,1,1],[0,0,0],1,0),m(t,e,[0,0,0],[r,0,0],0,0),m(n,e,[1,1,1],[0,0,0],1,0),m(n,e,[0,0,0],[r,0,0],0,1)}const _=H(3,2*a*4,Uint16Array);function b(e,t){for(let n=0;n<a;++n)_.push(e+n+0,e+n+1,t+n+0),_.push(e+n+1,t+n+1,t+n+0)}const g=a+1;return b(0*g,4*g),b(5*g,7*g),b(6*g,2*g),b(3*g,1*g),{position:d,normal:f,texcoord:h,indices:_}}function oe(e,t,n,r,i,o){return te(e,e,t,n,r,i,o)}function ae(e,t,n,r,i,o){if(n<3)throw new Error("radialSubdivisions must be 3 or greater");if(r<3)throw new Error("verticalSubdivisions must be 3 or greater");i=i||0;const a=(o=o||2*Math.PI)-i,s=n+1,l=r+1,u=s*l,c=H(3,u),d=H(3,u),f=H(2,u),h=H(3,n*r*2,Uint16Array);for(let o=0;o<l;++o){const l=o/r,u=l*Math.PI*2,h=Math.sin(u),p=e+h*t,m=Math.cos(u),_=m*t;for(let e=0;e<s;++e){const t=e/n,r=i+t*a,o=Math.sin(r),s=Math.cos(r),u=o*p,b=s*p,g=o*h,v=s*h;c.push(u,_,b),d.push(g,m,v),f.push(t,1-l)}}for(let e=0;e<r;++e)for(let t=0;t<n;++t){const n=1+t,r=1+e;h.push(s*e+t,s*r+t,s*e+n),h.push(s*r+t,s*r+n,s*e+n)}return{position:c,normal:d,texcoord:f,indices:h}}function se(e,t,n,r,i){if(t<3)throw new Error("divisions must be at least 3");i=i||1,r=r||0;const o=(t+1)*((n=n||1)+1),a=H(3,o),s=H(3,o),l=H(2,o),u=H(3,n*t*2,Uint16Array);let c=0;const d=e-r,f=t+1;for(let e=0;e<=n;++e){const o=r+d*Math.pow(e/n,i);for(let r=0;r<=t;++r){const i=2*Math.PI*r/t,d=o*Math.cos(i),h=o*Math.sin(i);if(a.push(d,0,h),s.push(0,1,0),l.push(1-r/t,e/n),e>0&&r!==t){const e=c+(r+1),t=c+r,n=c+r-f,i=c+(r+1)-f;u.push(e,t,n),u.push(e,n,i)}}c+=t+1}return{position:a,normal:s,texcoord:l,indices:u}}function le(e){return function(t){const n=e.apply(this,Array.prototype.slice.call(arguments,1));return j(t,n)}}function ue(e){return function(t){const n=e.apply(null,Array.prototype.slice.call(arguments,1));return M(t,n)}}ue(re),le(re),ue(ee),le(ee),ue(Z),le(Z),ue($),le($),ue(te),le(te),ue(Q),le(Q),ue(ie),le(ie),ue(oe),le(oe),ue(ae),le(ae),ue(se),le(se);function ce(e){return!!e.texStorage2D}const de=function(){const e={},t={};return function(n,r){return function(n){const r=n.constructor.name;if(!e[r]){for(const e in n)if("number"==typeof n[e]){const r=t[n[e]];t[n[e]]=r?`${r} | ${e}`:e}e[r]=!0}}(n),t[r]||("number"==typeof r?`0x${r.toString(16)}`:r)}}();const fe={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},he=x,pe=function(){let e;return function(){return e=e||("undefined"!=typeof document&&document.createElement?document.createElement("canvas").getContext("2d"):null),e}}(),me=6406,_e=6407,be=6408,ge=6409,ve=6410,ye=6402,xe=34041,we=33071,Ee=3553,Ae=34067,Ce=32879,Se=35866,Fe=34069,Pe=10241,ke=10240,Te=10242,Oe=10243,Le=3317,Ie=5120,Re=5121,De=5122,ze=5123,Ne=5124,Be=5125,Me=5126,Ue=5131,je=36193,Ge=33640,He=33319,Ve=33320,We=6403,qe=36244,Xe=36248,Ke=36249,Ye={};{const e=Ye;e[6406]={numColorComponents:1},e[6409]={numColorComponents:1},e[6410]={numColorComponents:2},e[6407]={numColorComponents:3},e[6408]={numColorComponents:4},e[6403]={numColorComponents:1},e[36244]={numColorComponents:1},e[33319]={numColorComponents:2},e[33320]={numColorComponents:2},e[6407]={numColorComponents:3},e[36248]={numColorComponents:3},e[6408]={numColorComponents:4},e[36249]={numColorComponents:4},e[6402]={numColorComponents:1},e[34041]={numColorComponents:2}}let Qe;function Ze(e){if(!Qe){const e={};e[6406]={textureFormat:me,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[Re,Ue,je,Me]},e[6409]={textureFormat:ge,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[Re,Ue,je,Me]},e[6410]={textureFormat:ve,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[Re,Ue,je,Me]},e[6407]={textureFormat:_e,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[Re,Ue,je,Me,33635]},e[6408]={textureFormat:be,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[Re,Ue,je,Me,32819,32820]},e[6402]={textureFormat:ye,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[Be,ze]},e[33321]={textureFormat:We,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[Re]},e[36756]={textureFormat:We,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[Ie]},e[33325]={textureFormat:We,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[Me,Ue]},e[33326]={textureFormat:We,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[Me]},e[33330]={textureFormat:qe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[Re]},e[33329]={textureFormat:qe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[Ie]},e[33332]={textureFormat:qe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[ze]},e[33331]={textureFormat:qe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[De]},e[33334]={textureFormat:qe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Be]},e[33333]={textureFormat:qe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Ne]},e[33323]={textureFormat:He,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[Re]},e[36757]={textureFormat:He,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[Ie]},e[33327]={textureFormat:He,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[Me,Ue]},e[33328]={textureFormat:He,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[Me]},e[33336]={textureFormat:Ve,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Re]},e[33335]={textureFormat:Ve,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Ie]},e[33338]={textureFormat:Ve,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ze]},e[33337]={textureFormat:Ve,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[De]},e[33340]={textureFormat:Ve,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Be]},e[33339]={textureFormat:Ve,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Ne]},e[32849]={textureFormat:_e,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[Re]},e[35905]={textureFormat:_e,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[Re]},e[36194]={textureFormat:_e,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[Re,33635]},e[36758]={textureFormat:_e,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[Ie]},e[35898]={textureFormat:_e,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[Me,Ue,35899]},e[35901]={textureFormat:_e,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[Me,Ue,35902]},e[34843]={textureFormat:_e,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[Me,Ue]},e[34837]={textureFormat:_e,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[Me]},e[36221]={textureFormat:Xe,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[Re]},e[36239]={textureFormat:Xe,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[Ie]},e[36215]={textureFormat:Xe,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[ze]},e[36233]={textureFormat:Xe,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[De]},e[36209]={textureFormat:Xe,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[Be]},e[36227]={textureFormat:Xe,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[Ne]},e[32856]={textureFormat:be,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[Re]},e[35907]={textureFormat:be,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[Re]},e[36759]={textureFormat:be,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[Ie]},e[32855]={textureFormat:be,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[Re,32820,Ge]},e[32854]={textureFormat:be,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[Re,32819]},e[32857]={textureFormat:be,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[Ge]},e[34842]={textureFormat:be,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[Me,Ue]},e[34836]={textureFormat:be,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[Me]},e[36220]={textureFormat:Ke,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Re]},e[36238]={textureFormat:Ke,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Ie]},e[36975]={textureFormat:Ke,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Ge]},e[36214]={textureFormat:Ke,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[ze]},e[36232]={textureFormat:Ke,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[De]},e[36226]={textureFormat:Ke,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[Ne]},e[36208]={textureFormat:Ke,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[Be]},e[33189]={textureFormat:ye,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[ze,Be]},e[33190]={textureFormat:ye,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Be]},e[36012]={textureFormat:ye,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Me]},e[35056]={textureFormat:xe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[34042]},e[36013]={textureFormat:xe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[36269]},Object.keys(e).forEach((function(t){const n=e[t];n.bytesPerElementMap={},n.bytesPerElement.forEach((function(e,t){const r=n.type[t];n.bytesPerElementMap[r]=e}))})),Qe=e}return Qe[e]}function $e(e,t){const n=Ze(e);if(!n)throw"unknown internal format";const r=n.bytesPerElementMap[t];if(void 0===r)throw"unknown internal format";return r}function Je(e){const t=Ze(e);if(!t)throw"unknown internal format";return{format:t.textureFormat,type:t.type[0]}}function et(e){return 0==(e&e-1)}function tt(e,t,n,r){if(!ce(e))return et(t)&&et(n);const i=Ze(r);if(!i)throw"unknown internal format";return i.colorRenderable&&i.textureFilterable}function nt(e){const t=Ze(e);if(!t)throw"unknown internal format";return t.textureFilterable}function rt(e,t,n){return he(t)?g(t):n||Re}function it(e,t,n,r,i){if(i%1!=0)throw"can't guess dimensions";if(n||r){if(r){if(!n&&(n=i/r)%1)throw"can't guess dimensions"}else if((r=i/n)%1)throw"can't guess dimensions"}else{const e=Math.sqrt(i/(t===Ae?6:1));e%1==0?(n=e,r=e):(n=i,r=1)}return{width:n,height:r}}function ot(e,t){void 0!==t.colorspaceConversion&&e.pixelStorei(37443,t.colorspaceConversion),void 0!==t.premultiplyAlpha&&e.pixelStorei(37441,t.premultiplyAlpha),void 0!==t.flipY&&e.pixelStorei(37440,t.flipY)}function at(e){e.pixelStorei(Le,4),ce(e)&&(e.pixelStorei(3314,0),e.pixelStorei(32878,0),e.pixelStorei(3316,0),e.pixelStorei(3315,0),e.pixelStorei(32877,0))}function st(e,t,n,r){var i;r.minMag&&(n.call(e,t,Pe,r.minMag),n.call(e,t,ke,r.minMag)),r.min&&n.call(e,t,Pe,r.min),r.mag&&n.call(e,t,ke,r.mag),r.wrap&&(n.call(e,t,Te,r.wrap),n.call(e,t,Oe,r.wrap),(t===Ce||(i=t,"undefined"!=typeof WebGLSampler&&i instanceof WebGLSampler))&&n.call(e,t,32882,r.wrap)),r.wrapR&&n.call(e,t,32882,r.wrapR),r.wrapS&&n.call(e,t,Te,r.wrapS),r.wrapT&&n.call(e,t,Oe,r.wrapT),r.minLod&&n.call(e,t,33082,r.minLod),r.maxLod&&n.call(e,t,33083,r.maxLod),r.baseLevel&&n.call(e,t,33084,r.baseLevel),r.maxLevel&&n.call(e,t,33085,r.maxLevel)}function lt(e,t,n){const r=n.target||Ee;e.bindTexture(r,t),st(e,r,e.texParameteri,n)}function ut(e,t,n,r,i,o){n=n||fe.textureOptions,o=o||be;const a=n.target||Ee;if(r=r||n.width,i=i||n.height,e.bindTexture(a,t),tt(e,r,i,o))e.generateMipmap(a);else{const t=nt(o)?9729:9728;e.texParameteri(a,Pe,t),e.texParameteri(a,ke,t),e.texParameteri(a,Te,we),e.texParameteri(a,Oe,we)}}function ct(e){return!0===e.auto||void 0===e.auto&&void 0===e.level}function dt(e,t){return(t=t||{}).cubeFaceOrder||[Fe,34070,34071,34072,34073,34074]}function ft(e,t){const n=dt(0,t).map((function(e,t){return{face:e,ndx:t}}));return n.sort((function(e,t){return e.face-t.face})),n}function ht(e,t,n,r){const i=(r=r||fe.textureOptions).target||Ee,o=r.level||0;let a=n.width,s=n.height;const l=r.internalFormat||r.format||be,u=Je(l),c=r.format||u.format,d=r.type||u.type;if(ot(e,r),e.bindTexture(i,t),i===Ae){const u=n.width,f=n.height;let h,p;if(u/6===f)h=f,p=[0,0,1,0,2,0,3,0,4,0,5,0];else if(f/6===u)h=u,p=[0,0,0,1,0,2,0,3,0,4,0,5];else if(u/3==f/2)h=u/3,p=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(u/2!=f/3)throw"can't figure out cube map from element: "+(n.src?n.src:n.nodeName);h=u/2,p=[0,0,1,0,0,1,1,1,0,2,1,2]}const m=pe();m?(m.canvas.width=h,m.canvas.height=h,a=h,s=h,ft(0,r).forEach((function(t){const r=p[2*t.ndx+0]*h,i=p[2*t.ndx+1]*h;m.drawImage(n,r,i,h,h,0,0,h,h),e.texImage2D(t.face,o,l,c,d,m.canvas)})),m.canvas.width=1,m.canvas.height=1):"undefined"!=typeof createImageBitmap&&(a=h,s=h,ft(0,r).forEach((function(u){const f=p[2*u.ndx+0]*h,m=p[2*u.ndx+1]*h;e.texImage2D(u.face,o,l,h,h,0,c,d,null),createImageBitmap(n,f,m,h,h,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then((function(n){ot(e,r),e.bindTexture(i,t),e.texImage2D(u.face,o,l,c,d,n),ct(r)&&ut(e,t,r,a,s,l)}))})))}else if(i===Ce||i===Se){const t=Math.min(n.width,n.height),r=Math.max(n.width,n.height),a=r/t;if(a%1!=0)throw"can not compute 3D dimensions of element";const s=n.width===r?1:0,u=n.height===r?1:0;e.pixelStorei(Le,1),e.pixelStorei(3314,n.width),e.pixelStorei(32878,0),e.pixelStorei(32877,0),e.texImage3D(i,o,l,t,t,t,0,c,d,null);for(let r=0;r<a;++r){const a=r*t*s,l=r*t*u;e.pixelStorei(3316,a),e.pixelStorei(3315,l),e.texSubImage3D(i,o,0,0,r,t,t,1,c,d,n)}at(e)}else e.texImage2D(i,o,l,c,d,n);ct(r)&&ut(e,t,r,a,s,l),lt(e,t,r)}function pt(){}function mt(e,t){return void 0!==t||function(e){if("undefined"!=typeof document){const t=document.createElement("a");return t.href=e,t.hostname===location.hostname&&t.port===location.port&&t.protocol===location.protocol}{const t=new URL(location.href).origin;return new URL(e,location.href).origin===t}}(e)?t:"anonymous"}function _t(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof HTMLElement&&e instanceof HTMLElement}function bt(e,t,n){return _t(e)?(setTimeout((function(){n(null,e)})),e):function(e,t,n){let r;if(n=n||pt,t=void 0!==t?t:fe.crossOrigin,t=mt(e,t),"undefined"!=typeof Image){r=new Image,void 0!==t&&(r.crossOrigin=t);const i=function(){r.removeEventListener("error",o),r.removeEventListener("load",a),r=null},o=function(){const t="couldn't load image: "+e;w(t),n(t,r),i()},a=function(){n(null,r),i()};return r.addEventListener("error",o),r.addEventListener("load",a),r.src=e,r}if("undefined"!=typeof ImageBitmap){let i,o;const a=function(){n(i,o)},s={};t&&(s.mode="cors"),fetch(e,s).then((function(e){if(!e.ok)throw e;return e.blob()})).then((function(e){return createImageBitmap(e,{premultiplyAlpha:"none",colorSpaceConversion:"none"})})).then((function(e){o=e,setTimeout(a)})).catch((function(e){i=e,setTimeout(a)})),r=null}return r}(e,t,n)}function gt(e,t,n){const r=(n=n||fe.textureOptions).target||Ee;if(e.bindTexture(r,t),!1===n.color)return;const i=function(e){return e=e||fe.textureColor,he(e)?e:new Uint8Array([255*e[0],255*e[1],255*e[2],255*e[3]])}(n.color);if(r===Ae)for(let t=0;t<6;++t)e.texImage2D(Fe+t,0,be,1,1,0,be,Re,i);else r===Ce||r===Se?e.texImage3D(r,0,be,1,1,1,0,be,Re,i):e.texImage2D(r,0,be,1,1,0,be,Re,i)}function vt(e,t,n,r){r=r||pt,n=n||fe.textureOptions,gt(e,t,n);return bt((n=Object.assign({},n)).src,n.crossOrigin,(function(i,o){i?r(i,t,o):(ht(e,t,o,n),r(null,t,o))}))}function yt(e,t,n,r){r=r||pt;const i=n.src;if(6!==i.length)throw"there must be 6 urls for a cubemap";const o=n.level||0,a=n.internalFormat||n.format||be,s=Je(a),l=n.format||s.format,u=n.type||Re,c=n.target||Ee;if(c!==Ae)throw"target must be TEXTURE_CUBE_MAP";gt(e,t,n),n=Object.assign({},n);let d=6;const f=[],h=dt(0,n);let p;p=i.map((function(i,s){return bt(i,n.crossOrigin,(m=h[s],function(i,s){--d,i?f.push(i):s.width!==s.height?f.push("cubemap face img is not a square: "+s.src):(ot(e,n),e.bindTexture(c,t),5===d?dt().forEach((function(t){e.texImage2D(t,o,a,l,u,s)})):e.texImage2D(m,o,a,l,u,s),ct(n)&&e.generateMipmap(c)),0===d&&r(f.length?f:void 0,t,p)}));var m}))}function xt(e,t,n,r){r=r||pt;const i=n.src,o=n.internalFormat||n.format||be,a=Je(o),s=n.format||a.format,l=n.type||Re,u=n.target||Se;if(u!==Ce&&u!==Se)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";gt(e,t,n),n=Object.assign({},n);let c=i.length;const d=[];let f;const h=n.level||0;let p=n.width,m=n.height;const _=i.length;let b=!0;f=i.map((function(i,a){return bt(i,n.crossOrigin,(g=a,function(i,a){if(--c,i)d.push(i);else{if(ot(e,n),e.bindTexture(u,t),b){b=!1,p=n.width||a.width,m=n.height||a.height,e.texImage3D(u,h,o,p,m,_,0,s,l,null);for(let t=0;t<_;++t)e.texSubImage3D(u,h,0,0,t,p,m,1,s,l,a)}else{let t,n=a;a.width===p&&a.height===m||(t=pe(),n=t.canvas,t.canvas.width=p,t.canvas.height=m,t.drawImage(a,0,0,p,m)),e.texSubImage3D(u,h,0,0,g,p,m,1,s,l,n),t&&n===t.canvas&&(t.canvas.width=0,t.canvas.height=0)}ct(n)&&e.generateMipmap(u)}0===c&&r(d.length?d:void 0,t,f)}));var g}))}function wt(e,t,n,r){const i=(r=r||fe.textureOptions).target||Ee;e.bindTexture(i,t);let o=r.width,a=r.height,s=r.depth;const l=r.level||0,u=r.internalFormat||r.format||be,c=Je(u),d=r.format||c.format,f=r.type||rt(0,n,c.type);if(he(n))n instanceof Uint8ClampedArray&&(n=new Uint8Array(n.buffer));else{const e=y(f);n=new e(n)}const h=$e(u,f),p=n.byteLength/h;if(p%1)throw"length wrong size for format: "+de(e,d);let m;if(i===Ce||i===Se)if(o||a||s)!o||a&&s?!a||o&&s?(m=it(0,i,o,a,p/s),o=m.width,a=m.height):(m=it(0,i,o,s,p/a),o=m.width,s=m.height):(m=it(0,i,a,s,p/o),a=m.width,s=m.height);else{const e=Math.cbrt(p);if(e%1!=0)throw"can't guess cube size of array of numElements: "+p;o=e,a=e,s=e}else m=it(0,i,o,a,p),o=m.width,a=m.height;if(at(e),e.pixelStorei(Le,r.unpackAlignment||1),ot(e,r),i===Ae){const t=p/6*(h/n.BYTES_PER_ELEMENT);ft(0,r).forEach((r=>{const i=t*r.ndx,s=n.subarray(i,i+t);e.texImage2D(r.face,l,u,o,a,0,d,f,s)}))}else i===Ce||i===Se?e.texImage3D(i,l,u,o,a,s,0,d,f,n):e.texImage2D(i,l,u,o,a,0,d,f,n);return{width:o,height:a,depth:s,type:f}}function Et(e,t,n){const r=n.target||Ee;e.bindTexture(r,t);const i=n.level||0,o=n.internalFormat||n.format||be,a=Je(o),s=n.format||a.format,l=n.type||a.type;if(ot(e,n),r===Ae)for(let t=0;t<6;++t)e.texImage2D(Fe+t,i,o,n.width,n.height,0,s,l,null);else r===Ce||r===Se?e.texImage3D(r,i,o,n.width,n.height,n.depth,0,s,l,null):e.texImage2D(r,i,o,n.width,n.height,0,s,l,null)}function At(e,t,n){n=n||pt,t=t||fe.textureOptions;const r=e.createTexture(),i=t.target||Ee;let o=t.width||1,a=t.height||1;const s=t.internalFormat||be;e.bindTexture(i,r),i===Ae&&(e.texParameteri(i,Te,we),e.texParameteri(i,Oe,we));let l=t.src;if(l)if("function"==typeof l&&(l=l(e,t)),"string"==typeof l)vt(e,r,t,n);else if(he(l)||Array.isArray(l)&&("number"==typeof l[0]||Array.isArray(l[0])||he(l[0]))){const n=wt(e,r,l,t);o=n.width,a=n.height}else Array.isArray(l)&&("string"==typeof l[0]||_t(l[0]))?i===Ae?yt(e,r,t,n):xt(e,r,t,n):(ht(e,r,l,t),o=l.width,a=l.height);else Et(e,r,t);return ct(t)&&ut(e,r,t,o,a,s),lt(e,r,t),r}const Ct=w;function St(e){return"undefined"!=typeof document&&document.getElementById?document.getElementById(e):null}const Ft=33984,Pt=34962,kt=5126,Tt=5124,Ot=5125,Lt=3553,It=34067,Rt=32879,Dt=35866,zt={};function Nt(e,t){return zt[t].bindPoint}function Bt(e,t){return function(n){e.uniform1i(t,n)}}function Mt(e,t){return function(n){e.uniform1iv(t,n)}}function Ut(e,t){return function(n){e.uniform2iv(t,n)}}function jt(e,t){return function(n){e.uniform3iv(t,n)}}function Gt(e,t){return function(n){e.uniform4iv(t,n)}}function Ht(e,t,n,r){const i=Nt(0,t);return ce(e)?function(t){let o,a;C(0,t)?(o=t,a=null):(o=t.texture,a=t.sampler),e.uniform1i(r,n),e.activeTexture(Ft+n),e.bindTexture(i,o),e.bindSampler(n,a)}:function(t){e.uniform1i(r,n),e.activeTexture(Ft+n),e.bindTexture(i,t)}}function Vt(e,t,n,r,i){const o=Nt(0,t),a=new Int32Array(i);for(let e=0;e<i;++e)a[e]=n+e;return ce(e)?function(t){e.uniform1iv(r,a),t.forEach((function(t,r){let i,s;e.activeTexture(Ft+a[r]),C(0,t)?(i=t,s=null):(i=t.texture,s=t.sampler),e.bindSampler(n,s),e.bindTexture(o,i)}))}:function(t){e.uniform1iv(r,a),t.forEach((function(t,n){e.activeTexture(Ft+a[n]),e.bindTexture(o,t)}))}}function Wt(e,t){return function(n){if(n.value)switch(e.disableVertexAttribArray(t),n.value.length){case 4:e.vertexAttrib4fv(t,n.value);break;case 3:e.vertexAttrib3fv(t,n.value);break;case 2:e.vertexAttrib2fv(t,n.value);break;case 1:e.vertexAttrib1fv(t,n.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(Pt,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,n.numComponents||n.size,n.type||kt,n.normalize||!1,n.stride||0,n.offset||0),void 0!==n.divisor&&e.vertexAttribDivisor(t,n.divisor)}}function qt(e,t){return function(n){if(n.value){if(e.disableVertexAttribArray(t),4!==n.value.length)throw new Error("The length of an integer constant value must be 4!");e.vertexAttrib4iv(t,n.value)}else e.bindBuffer(Pt,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,n.numComponents||n.size,n.type||Tt,n.stride||0,n.offset||0),void 0!==n.divisor&&e.vertexAttribDivisor(t,n.divisor)}}function Xt(e,t){return function(n){if(n.value){if(e.disableVertexAttribArray(t),4!==n.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");e.vertexAttrib4uiv(t,n.value)}else e.bindBuffer(Pt,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,n.numComponents||n.size,n.type||Ot,n.stride||0,n.offset||0),void 0!==n.divisor&&e.vertexAttribDivisor(t,n.divisor)}}function Kt(e,t,n){const r=n.size,i=n.count;return function(n){e.bindBuffer(Pt,n.buffer);const o=n.size||n.numComponents||r,a=o/i,s=n.type||kt,l=zt[s].size*o,u=n.normalize||!1,c=n.offset||0,d=l/i;for(let r=0;r<i;++r)e.enableVertexAttribArray(t+r),e.vertexAttribPointer(t+r,a,s,u,l,c+d*r),void 0!==n.divisor&&e.vertexAttribDivisor(t+r,n.divisor)}}zt[5126]={Type:Float32Array,size:4,setter:function(e,t){return function(n){e.uniform1f(t,n)}},arraySetter:function(e,t){return function(n){e.uniform1fv(t,n)}}},zt[35664]={Type:Float32Array,size:8,setter:function(e,t){return function(n){e.uniform2fv(t,n)}}},zt[35665]={Type:Float32Array,size:12,setter:function(e,t){return function(n){e.uniform3fv(t,n)}}},zt[35666]={Type:Float32Array,size:16,setter:function(e,t){return function(n){e.uniform4fv(t,n)}}},zt[5124]={Type:Int32Array,size:4,setter:Bt,arraySetter:Mt},zt[35667]={Type:Int32Array,size:8,setter:Ut},zt[35668]={Type:Int32Array,size:12,setter:jt},zt[35669]={Type:Int32Array,size:16,setter:Gt},zt[5125]={Type:Uint32Array,size:4,setter:function(e,t){return function(n){e.uniform1ui(t,n)}},arraySetter:function(e,t){return function(n){e.uniform1uiv(t,n)}}},zt[36294]={Type:Uint32Array,size:8,setter:function(e,t){return function(n){e.uniform2uiv(t,n)}}},zt[36295]={Type:Uint32Array,size:12,setter:function(e,t){return function(n){e.uniform3uiv(t,n)}}},zt[36296]={Type:Uint32Array,size:16,setter:function(e,t){return function(n){e.uniform4uiv(t,n)}}},zt[35670]={Type:Uint32Array,size:4,setter:Bt,arraySetter:Mt},zt[35671]={Type:Uint32Array,size:8,setter:Ut},zt[35672]={Type:Uint32Array,size:12,setter:jt},zt[35673]={Type:Uint32Array,size:16,setter:Gt},zt[35674]={Type:Float32Array,size:16,setter:function(e,t){return function(n){e.uniformMatrix2fv(t,!1,n)}}},zt[35675]={Type:Float32Array,size:36,setter:function(e,t){return function(n){e.uniformMatrix3fv(t,!1,n)}}},zt[35676]={Type:Float32Array,size:64,setter:function(e,t){return function(n){e.uniformMatrix4fv(t,!1,n)}}},zt[35685]={Type:Float32Array,size:24,setter:function(e,t){return function(n){e.uniformMatrix2x3fv(t,!1,n)}}},zt[35686]={Type:Float32Array,size:32,setter:function(e,t){return function(n){e.uniformMatrix2x4fv(t,!1,n)}}},zt[35687]={Type:Float32Array,size:24,setter:function(e,t){return function(n){e.uniformMatrix3x2fv(t,!1,n)}}},zt[35688]={Type:Float32Array,size:48,setter:function(e,t){return function(n){e.uniformMatrix3x4fv(t,!1,n)}}},zt[35689]={Type:Float32Array,size:32,setter:function(e,t){return function(n){e.uniformMatrix4x2fv(t,!1,n)}}},zt[35690]={Type:Float32Array,size:48,setter:function(e,t){return function(n){e.uniformMatrix4x3fv(t,!1,n)}}},zt[35678]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:Lt},zt[35680]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:It},zt[35679]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:Rt},zt[35682]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:Lt},zt[36289]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:Dt},zt[36292]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:Dt},zt[36293]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:It},zt[36298]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:Lt},zt[36299]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:Rt},zt[36300]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:It},zt[36303]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:Dt},zt[36306]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:Lt},zt[36307]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:Rt},zt[36308]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:It},zt[36311]={Type:null,size:0,setter:Ht,arraySetter:Vt,bindPoint:Dt};const Yt={};Yt[5126]={size:4,setter:Wt},Yt[35664]={size:8,setter:Wt},Yt[35665]={size:12,setter:Wt},Yt[35666]={size:16,setter:Wt},Yt[5124]={size:4,setter:qt},Yt[35667]={size:8,setter:qt},Yt[35668]={size:12,setter:qt},Yt[35669]={size:16,setter:qt},Yt[5125]={size:4,setter:Xt},Yt[36294]={size:8,setter:Xt},Yt[36295]={size:12,setter:Xt},Yt[36296]={size:16,setter:Xt},Yt[35670]={size:4,setter:qt},Yt[35671]={size:8,setter:qt},Yt[35672]={size:12,setter:qt},Yt[35673]={size:16,setter:qt},Yt[35674]={size:4,setter:Kt,count:2},Yt[35675]={size:9,setter:Kt,count:3},Yt[35676]={size:16,setter:Kt,count:4};const Qt=/ERROR:\s*\d+:(\d+)/gi;function Zt(e,t="",n=0){const r=[...t.matchAll(Qt)],i=new Map(r.map(((e,n)=>{const i=parseInt(e[1]),o=r[n+1],a=o?o.index:t.length;return[i-1,t.substring(e.index,a)]})));return e.split("\n").map(((e,t)=>{const r=i.get(t);return`${t+1+n}: ${e}${r?`\n\n^^^ ${r}`:""}`})).join("\n")}const $t=/^[ \t]*\n/;function Jt(e,t,n,r){const i=r||Ct,o=e.createShader(n);let a=0;$t.test(t)&&(a=1,t=t.replace($t,"")),e.shaderSource(o,t),e.compileShader(o);if(!e.getShaderParameter(o,35713)){const r=e.getShaderInfoLog(o);return i(`${Zt(t,r,a)}\nError compiling ${de(e,n)}: ${r}`),e.deleteShader(o),null}return o}function en(e,t,n){let r,i;if("function"==typeof t&&(n=t,t=void 0),"function"==typeof e)n=e,e=void 0;else if(e&&!Array.isArray(e)){if(e.errorCallback)return e;const t=e;n=t.errorCallback,e=t.attribLocations,r=t.transformFeedbackVaryings,i=t.transformFeedbackMode}const o={errorCallback:n||Ct,transformFeedbackVaryings:r,transformFeedbackMode:i};if(e){let n={};Array.isArray(e)?e.forEach((function(e,r){n[e]=t?t[r]:r})):n=e,o.attribLocations=n}return o}const tn=["VERTEX_SHADER","FRAGMENT_SHADER"];function nn(e,t){return t.indexOf("frag")>=0?35632:t.indexOf("vert")>=0?35633:void 0}function rn(e,t){t.forEach((function(t){e.deleteShader(t)}))}function on(e,t,n,r,i){const o=en(n,r,i),a=[],s=[];for(let n=0;n<t.length;++n){let r=t[n];if("string"==typeof r){const t=St(r),i=t?t.text:r;let a=e[tn[n]];t&&t.type&&(a=nn(0,t.type)||a),r=Jt(e,i,a,o.errorCallback),s.push(r)}l=r,"undefined"!=typeof WebGLShader&&l instanceof WebGLShader&&a.push(r)}var l;if(a.length!==t.length)return o.errorCallback("not enough shaders for program"),rn(e,s),null;const u=e.createProgram();a.forEach((function(t){e.attachShader(u,t)})),o.attribLocations&&Object.keys(o.attribLocations).forEach((function(t){e.bindAttribLocation(u,o.attribLocations[t],t)}));let c=o.transformFeedbackVaryings;c&&(c.attribs&&(c=c.attribs),Array.isArray(c)||(c=Object.keys(c)),e.transformFeedbackVaryings(u,c,o.transformFeedbackMode||35981)),e.linkProgram(u);if(!e.getProgramParameter(u,35714)){const t=e.getProgramInfoLog(u);return o.errorCallback(`${a.map((t=>{const n=Zt(e.getShaderSource(t),"",0),r=e.getShaderParameter(t,e.SHADER_TYPE);return`${de(e,r)}\n${n}}`})).join("\n")}\nError in program linking: ${t}`),e.deleteProgram(u),rn(e,s),null}return u}function an(e,t,n,r,i){const o=en(n,r,i),a=[];for(let n=0;n<t.length;++n){const r=Jt(e,t[n],e[tn[n]],o.errorCallback);if(!r)return null;a.push(r)}return on(e,a,o)}function sn(e){const t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}function ln(e,t){let n=0;function r(t,r,i){const o=r.name.endsWith("[0]"),a=r.type,s=zt[a];if(!s)throw new Error(`unknown type: 0x${a.toString(16)}`);let l;if(s.bindPoint){const t=n;n+=r.size,l=o?s.arraySetter(e,a,t,i,r.size):s.setter(e,a,t,i,r.size)}else l=s.arraySetter&&o?s.arraySetter(e,i):s.setter(e,i);return l.location=i,l}const i={},o=e.getProgramParameter(t,35718);for(let n=0;n<o;++n){const o=e.getActiveUniform(t,n);if(sn(o))continue;let a=o.name;a.endsWith("[0]")&&(a=a.substr(0,a.length-3));const s=e.getUniformLocation(t,o.name);s&&(i[a]=r(0,o,s))}return i}function un(e,t){const n={},r=e.getProgramParameter(t,35971);for(let i=0;i<r;++i){const r=e.getTransformFeedbackVarying(t,i);n[r.name]={index:i,type:r.type,size:r.size}}return n}function cn(e,t){const n=e.getProgramParameter(t,35718),r=[],i=[];for(let o=0;o<n;++o){i.push(o),r.push({});const n=e.getActiveUniform(t,o);if(sn(n))break;r[o].name=n.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach((function(n){const o=n[0],a=n[1];e.getActiveUniforms(t,i,e[o]).forEach((function(e,t){r[t][a]=e}))}));const o={},a=e.getProgramParameter(t,35382);for(let n=0;n<a;++n){const r=e.getActiveUniformBlockName(t,n),i={index:e.getUniformBlockIndex(t,r),usedByVertexShader:e.getActiveUniformBlockParameter(t,n,35396),usedByFragmentShader:e.getActiveUniformBlockParameter(t,n,35398),size:e.getActiveUniformBlockParameter(t,n,35392),uniformIndices:e.getActiveUniformBlockParameter(t,n,35395)};i.used=i.usedByVertexShader||i.usedByFragmentShader,o[r]=i}return{blockSpecs:o,uniformData:r}}function dn(e,t){const n=e.uniformSetters||e,r=arguments.length;for(let e=1;e<r;++e){const t=arguments[e];if(Array.isArray(t)){const e=t.length;for(let r=0;r<e;++r)dn(n,t[r])}else for(const e in t){const r=n[e];r&&r(t[e])}}}function fn(e,t){const n={},r=e.getProgramParameter(t,35721);for(let i=0;i<r;++i){const r=e.getActiveAttrib(t,i);if(sn(r))continue;const o=e.getAttribLocation(t,r.name),a=Yt[r.type],s=a.setter(e,o,a);s.location=o,n[r.name]=s}return n}function hn(e,t){for(const n in t){const r=e[n];r&&r(t[n])}}function pn(e,t,n){n.vertexArrayObject?e.bindVertexArray(n.vertexArrayObject):(hn(t.attribSetters||t,n.attribs),n.indices&&e.bindBuffer(34963,n.indices))}function mn(e,t){const n={program:t,uniformSetters:ln(e,t),attribSetters:fn(e,t)};return ce(e)&&(n.uniformBlockSpec=cn(e,t),n.transformFeedbackInfo=un(e,t)),n}function _n(e,t,n,r,i){const o=en(n,r,i);let a=!0;if(t=t.map((function(e){if(e.indexOf("\n")<0){const t=St(e);t?e=t.text:(o.errorCallback("no element with id: "+e),a=!1)}return e})),!a)return null;const s=an(e,t,o);return s?mn(e,s):null}function bn(e,t,n,r,i,o){n=void 0===n?4:n;const a=t.indices,s=t.elementType,l=void 0===r?t.numElements:r;i=void 0===i?0:i,s||a?void 0!==o?e.drawElementsInstanced(n,l,void 0===s?5123:t.elementType,i,o):e.drawElements(n,l,void 0===s?5123:t.elementType,i):void 0!==o?e.drawArraysInstanced(n,i,l,o):e.drawArrays(n,i,l)}const gn=36161,vn=34041,yn=36096,xn=33306,wn=33071,En=9729,An=[{format:6408,type:5121,min:En,wrap:wn},{format:vn}],Cn={};Cn[34041]=xn,Cn[6401]=36128,Cn[36168]=36128,Cn[6402]=yn,Cn[33189]=yn,Cn[33190]=yn,Cn[36012]=yn,Cn[35056]=xn,Cn[36013]=xn;const Sn={};function Fn(e,t,n,r){const i=36160,o=e.createFramebuffer();e.bindFramebuffer(i,o),n=n||e.drawingBufferWidth,r=r||e.drawingBufferHeight;let a=0;const s={framebuffer:o,attachments:[],width:n,height:r};return(t=t||An).forEach((function(t){let o=t.attachment;const l=t.format;let u=t.attachmentPoint||function(e,t){return Cn[e]||Cn[t]}(l,t.internalFormat);if(u||(u=36064+a++),!o)if(function(e){return Sn[e]}(l))o=e.createRenderbuffer(),e.bindRenderbuffer(gn,o),e.renderbufferStorage(gn,l,n,r);else{const i=Object.assign({},t);i.width=n,i.height=r,void 0===i.auto&&(i.auto=!1,i.min=i.min||i.minMag||En,i.mag=i.mag||i.minMag||En,i.wrapS=i.wrapS||i.wrap||wn,i.wrapT=i.wrapT||i.wrap||wn),o=At(e,i)}if(A(0,o))e.framebufferRenderbuffer(i,u,gn,o);else{if(!C(0,o))throw new Error("unknown attachment type");void 0!==t.layer?e.framebufferTextureLayer(i,u,o,t.level||0,t.layer):e.framebufferTexture2D(i,u,t.target||3553,o,t.level||0)}s.attachments.push(o)})),s}function Pn(e,t,n){n=n||36160,t?(e.bindFramebuffer(n,t.framebuffer),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(n,null),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight))}Sn[32854]=!0,Sn[32855]=!0,Sn[36194]=!0,Sn[34041]=!0,Sn[33189]=!0,Sn[6401]=!0,Sn[36168]=!0;const kn={addExtensionsToContext:!0};const Tn=/^(.*?)_/;function On(e,t){de(e,0);const n=e.getExtension(t);if(n){const r={},i=Tn.exec(t)[1],o="_"+i;for(const t in n){const a=n[t],s="function"==typeof a,l=s?i:o;let u=t;t.endsWith(l)&&(u=t.substring(0,t.length-l.length)),void 0!==e[u]?s||e[u]===a||E(u,e[u],a,t):s?e[u]=function(e){return function(){return e.apply(n,arguments)}}(a):(e[u]=a,r[u]=a)}r.constructor={name:n.constructor.name},de(r,0)}return n}const Ln=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];function In(e){for(let t=0;t<Ln.length;++t)On(e,Ln[t])}function Rn(e,t){var n=e.__state.conversionName.toString(),r=Math.round(e.r),i=Math.round(e.g),o=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),u=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var c=e.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===n?"rgb("+r+","+i+","+o+")":"CSS_RGBA"===n?"rgba("+r+","+i+","+o+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+i+","+o+"]":"RGBA_ARRAY"===n?"["+r+","+i+","+o+","+a+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+i+",b:"+o+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+i+",b:"+o+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+u+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+u+",a:"+a+"}":"unknown format"}var Dn=Array.prototype.forEach,zn=Array.prototype.slice,Nn={BREAK:{},extend:function(e){return this.each(zn.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))}),this),e},defaults:function(e){return this.each(zn.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))}),this),e},compose:function(){var e=zn.call(arguments);return function(){for(var t=zn.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(Dn&&e.forEach&&e.forEach===Dn)e.forEach(t,n);else if(e.length===e.length+0){var r,i=void 0;for(i=0,r=e.length;i<r;i++)if(i in e&&t.call(n,e[i],i)===this.BREAK)return}else for(var o in e)if(t.call(n,e[o],o)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var r=void 0;return function(){var i=this,o=arguments;function a(){r=null,n||e.apply(i,o)}var s=n||!r;clearTimeout(r),r=setTimeout(a,t),s&&e.apply(i,o)}},toArray:function(e){return e.toArray?e.toArray():zn.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return e instanceof Function}},Bn=[{litmus:Nn.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:Rn},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:Rn},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:Rn},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:Rn}}},{litmus:Nn.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Nn.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Nn.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(Nn.isNumber(e.r)&&Nn.isNumber(e.g)&&Nn.isNumber(e.b)&&Nn.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(Nn.isNumber(e.r)&&Nn.isNumber(e.g)&&Nn.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(Nn.isNumber(e.h)&&Nn.isNumber(e.s)&&Nn.isNumber(e.v)&&Nn.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(Nn.isNumber(e.h)&&Nn.isNumber(e.s)&&Nn.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Mn=void 0,Un=void 0,jn=function(){Un=!1;var e=arguments.length>1?Nn.toArray(arguments):arguments[0];return Nn.each(Bn,(function(t){if(t.litmus(e))return Nn.each(t.conversions,(function(t,n){if(Mn=t.read(e),!1===Un&&!1!==Mn)return Un=Mn,Mn.conversionName=n,Mn.conversion=t,Nn.BREAK})),Nn.BREAK})),Un},Gn=void 0,Hn={hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),o=n*(1-t),a=n*(1-i*t),s=n*(1-(1-i)*t),l=[[n,s,o],[a,n,o],[o,n,s],[o,a,n],[s,o,n],[n,o,a]][r];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),o=i-r,a=void 0;return 0===i?{h:NaN,s:0,v:0}:(a=e===i?(t-n)/o:t===i?2+(n-e)/o:4+(e-t)/o,(a/=6)<0&&(a+=1),{h:360*a,s:o/i,v:i/255})},rgb_to_hex:function(e,t,n){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(Gn=8*t)|e&~(255<<Gn)}},Vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},qn=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Xn=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},Kn=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Yn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},Qn=function(){function e(){if(Wn(this,e),this.__state=jn.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return qn(e,[{key:"toString",value:function(){return Rn(this)}},{key:"toHexString",value:function(){return Rn(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function Zn(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||Qn.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(Qn.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function $n(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||Qn.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(Qn.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}Qn.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=Hn.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");Nn.extend(e.__state,Hn.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},Qn.recalculateHSV=function(e){var t=Hn.rgb_to_hsv(e.r,e.g,e.b);Nn.extend(e.__state,{s:t.s,v:t.v}),Nn.isNaN(t.h)?Nn.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},Qn.COMPONENTS=["r","g","b","h","s","v","hex","a"],Zn(Qn.prototype,"r",2),Zn(Qn.prototype,"g",1),Zn(Qn.prototype,"b",0),$n(Qn.prototype,"h"),$n(Qn.prototype,"s"),$n(Qn.prototype,"v"),Object.defineProperty(Qn.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(Qn.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=Hn.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var Jn=function(){function e(t,n){Wn(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return qn(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),er={};Nn.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(e,t){Nn.each(e,(function(e){er[e]=t}))}));var tr=/(\d+(\.\d+)?)px/;function nr(e){if("0"===e||Nn.isUndefined(e))return 0;var t=e.match(tr);return Nn.isNull(t)?0:parseFloat(t[1])}var rr={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var r=n,i=t;Nn.isUndefined(i)&&(i=!0),Nn.isUndefined(r)&&(r=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,r){var i=n||{},o=er[t];if(!o)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(o);switch(o){case"MouseEvents":var s=i.x||i.clientX||0,l=i.y||i.clientY||0;a.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,s,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var u=a.initKeyboardEvent||a.initKeyEvent;Nn.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:a.initEvent(t,i.bubbles||!1,i.cancelable||!0)}Nn.defaults(a,r),e.dispatchEvent(a)},bind:function(e,t,n,r){var i=r||!1;return e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n),rr},unbind:function(e,t,n,r){var i=r||!1;return e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on"+t,n),rr},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return rr},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);-1!==r&&(n.splice(r,1),e.className=n.join(" "))}else e.className=void 0;return rr},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return nr(t["border-left-width"])+nr(t["border-right-width"])+nr(t["padding-left"])+nr(t["padding-right"])+nr(t.width)},getHeight:function(e){var t=getComputedStyle(e);return nr(t["border-top-width"])+nr(t["border-bottom-width"])+nr(t["padding-top"])+nr(t["padding-bottom"])+nr(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},ir=function(e){function t(e,n){Wn(this,t);var r=Yn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),rr.bind(r.__checkbox,"change",(function(){i.setValue(!i.__prev)}),!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return Kn(t,e),qn(t,[{key:"setValue",value:function(e){var n=Xn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Xn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Jn),or=function(e){function t(e,n,r){Wn(this,t);var i=Yn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r,a=i;if(i.__select=document.createElement("select"),Nn.isArray(o)){var s={};Nn.each(o,(function(e){s[e]=e})),o=s}return Nn.each(o,(function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),a.__select.appendChild(n)})),i.updateDisplay(),rr.bind(i.__select,"change",(function(){var e=this.options[this.selectedIndex].value;a.setValue(e)})),i.domElement.appendChild(i.__select),i}return Kn(t,e),qn(t,[{key:"setValue",value:function(e){var n=Xn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return rr.isActive(this.__select)?this:(this.__select.value=this.getValue(),Xn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(Jn),ar=function(e){function t(e,n){Wn(this,t);var r=Yn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;function o(){i.setValue(i.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),rr.bind(r.__input,"keyup",o),rr.bind(r.__input,"change",o),rr.bind(r.__input,"blur",(function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())})),rr.bind(r.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return Kn(t,e),qn(t,[{key:"updateDisplay",value:function(){return rr.isActive(this.__input)||(this.__input.value=this.getValue()),Xn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Jn);function sr(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var lr=function(e){function t(e,n,r){Wn(this,t);var i=Yn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r||{};return i.__min=o.min,i.__max=o.max,i.__step=o.step,Nn.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=sr(i.__impliedStep),i}return Kn(t,e),qn(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),Xn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=sr(e),this}}]),t}(Jn);var ur=function(e){function t(e,n,r){Wn(this,t);var i=Yn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));i.__truncationSuspended=!1;var o=i,a=void 0;function s(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function l(e){var t=a-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),a=e.clientY}function u(){rr.unbind(window,"mousemove",l),rr.unbind(window,"mouseup",u),s()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),rr.bind(i.__input,"change",(function(){var e=parseFloat(o.__input.value);Nn.isNaN(e)||o.setValue(e)})),rr.bind(i.__input,"blur",(function(){s()})),rr.bind(i.__input,"mousedown",(function(e){rr.bind(window,"mousemove",l),rr.bind(window,"mouseup",u),a=e.clientY})),rr.bind(i.__input,"keydown",(function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,s())})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return Kn(t,e),qn(t,[{key:"updateDisplay",value:function(){var e,n,r;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),n=this.__precision,r=Math.pow(10,n),Math.round(e*r)/r),Xn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(lr);function cr(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}var dr=function(e){function t(e,n,r,i,o){Wn(this,t);var a=Yn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:r,max:i,step:o})),s=a;function l(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(cr(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function u(){rr.unbind(window,"mousemove",l),rr.unbind(window,"mouseup",u),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function c(e){var t=e.touches[0].clientX,n=s.__background.getBoundingClientRect();s.setValue(cr(t,n.left,n.right,s.__min,s.__max))}function d(){rr.unbind(window,"touchmove",c),rr.unbind(window,"touchend",d),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),rr.bind(a.__background,"mousedown",(function(e){document.activeElement.blur(),rr.bind(window,"mousemove",l),rr.bind(window,"mouseup",u),l(e)})),rr.bind(a.__background,"touchstart",(function(e){if(1!==e.touches.length)return;rr.bind(window,"touchmove",c),rr.bind(window,"touchend",d),c(e)})),rr.addClass(a.__background,"slider"),rr.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return Kn(t,e),qn(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Xn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(lr),fr=function(e){function t(e,n,r){Wn(this,t);var i=Yn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===r?"Fire":r,rr.bind(i.__button,"click",(function(e){return e.preventDefault(),o.fire(),!1})),rr.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return Kn(t,e),qn(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(Jn),hr=function(e){function t(e,n){Wn(this,t);var r=Yn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));r.__color=new Qn(r.getValue()),r.__temp=new Qn(0);var i=r;r.domElement=document.createElement("div"),rr.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",rr.bind(r.__input,"keydown",(function(e){13===e.keyCode&&d.call(this)})),rr.bind(r.__input,"blur",d),rr.bind(r.__selector,"mousedown",(function(){rr.addClass(this,"drag").bind(window,"mouseup",(function(){rr.removeClass(i.__selector,"drag")}))})),rr.bind(r.__selector,"touchstart",(function(){rr.addClass(this,"drag").bind(window,"touchend",(function(){rr.removeClass(i.__selector,"drag")}))}));var o,a=document.createElement("div");function s(e){h(e),rr.bind(window,"mousemove",h),rr.bind(window,"touchmove",h),rr.bind(window,"mouseup",u),rr.bind(window,"touchend",u)}function l(e){p(e),rr.bind(window,"mousemove",p),rr.bind(window,"touchmove",p),rr.bind(window,"mouseup",c),rr.bind(window,"touchend",c)}function u(){rr.unbind(window,"mousemove",h),rr.unbind(window,"touchmove",h),rr.unbind(window,"mouseup",u),rr.unbind(window,"touchend",u),f()}function c(){rr.unbind(window,"mousemove",p),rr.unbind(window,"touchmove",p),rr.unbind(window,"mouseup",c),rr.unbind(window,"touchend",c),f()}function d(){var e=jn(this.value);!1!==e?(i.__color.__state=e,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function f(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function h(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,r=n.clientX,o=n.clientY,a=(r-t.left)/(t.right-t.left),s=1-(o-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),i.__color.v=s,i.__color.s=a,i.setValue(i.__color.toOriginal()),!1}function p(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),i.__color.h=360*n,i.setValue(i.__color.toOriginal()),!1}return Nn.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Nn.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Nn.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Nn.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Nn.extend(a.style,{width:"100%",height:"100%",background:"none"}),mr(a,"top","rgba(0,0,0,0)","#000"),Nn.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(o=r.__hue_field).style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",Nn.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),rr.bind(r.__saturation_field,"mousedown",s),rr.bind(r.__saturation_field,"touchstart",s),rr.bind(r.__field_knob,"mousedown",s),rr.bind(r.__field_knob,"touchstart",s),rr.bind(r.__hue_field,"mousedown",l),rr.bind(r.__hue_field,"touchstart",l),r.__saturation_field.appendChild(a),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return Kn(t,e),qn(t,[{key:"updateDisplay",value:function(){var e=jn(this.getValue());if(!1!==e){var t=!1;Nn.each(Qn.COMPONENTS,(function(n){if(!Nn.isUndefined(e[n])&&!Nn.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}}),this),t&&Nn.extend(this.__color.__state,e)}Nn.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;Nn.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,mr(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Nn.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),t}(Jn),pr=["-moz-","-o-","-webkit-","-ms-",""];function mr(e,t,n,r){e.style.background="",Nn.each(pr,(function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "}))}var _r=function(e,t){var n=t||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var i=n.getElementsByTagName("head")[0];try{i.appendChild(r)}catch(e){}},br='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',gr=function(e,t){var n=e[t];return Nn.isArray(arguments[2])||Nn.isObject(arguments[2])?new or(e,t,arguments[2]):Nn.isNumber(n)?Nn.isNumber(arguments[2])&&Nn.isNumber(arguments[3])?Nn.isNumber(arguments[4])?new dr(e,t,arguments[2],arguments[3],arguments[4]):new dr(e,t,arguments[2],arguments[3]):Nn.isNumber(arguments[4])?new ur(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new ur(e,t,{min:arguments[2],max:arguments[3]}):Nn.isString(n)?new ar(e,t):Nn.isFunction(n)?new fr(e,t,""):Nn.isBoolean(n)?new ir(e,t):null};var vr=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},yr=function(){function e(){Wn(this,e),this.backgroundElement=document.createElement("div"),Nn.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),rr.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Nn.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;rr.bind(this.backgroundElement,"click",(function(){t.hide()}))}return qn(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Nn.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",rr.unbind(e.domElement,"webkitTransitionEnd",t),rr.unbind(e.domElement,"transitionend",t),rr.unbind(e.domElement,"oTransitionEnd",t)};rr.bind(this.domElement,"webkitTransitionEnd",t),rr.bind(this.domElement,"transitionend",t),rr.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-rr.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-rr.getHeight(this.domElement)/2+"px"}}]),e}();_r(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var xr="Default",wr=function(){try{return!!window.localStorage}catch(e){return!1}}(),Er=void 0,Ar=!0,Cr=void 0,Sr=!1,Fr=[],Pr=function e(t){var n=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),rr.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=Nn.defaults(r,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),r=Nn.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),Nn.isUndefined(r.load)?r.load={preset:xr}:r.preset&&(r.load.preset=r.preset),Nn.isUndefined(r.parent)&&r.hideable&&Fr.push(this),r.resizable=Nn.isUndefined(r.parent)&&r.resizable,r.autoPlace&&Nn.isUndefined(r.scrollable)&&(r.scrollable=!0);var i,o=wr&&"true"===localStorage.getItem(Rr(this,"isLocal")),a=void 0,s=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(e){n.parent?n.getRoot().preset=e:r.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,Br(n,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,s&&(s.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(t){r.closed=t,r.closed?rr.addClass(n.__ul,e.CLASS_CLOSED):rr.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return o},set:function(e){wr&&(o=e,e?rr.bind(window,"unload",a):rr.unbind(window,"unload",a),localStorage.setItem(Rr(n,"isLocal"),e))}}}),Nn.isUndefined(r.parent)){if(this.closed=r.closed||!1,rr.addClass(this.domElement,e.CLASS_MAIN),rr.makeSelectable(this.domElement,!1),wr&&o){n.useLocalStorage=!0;var l=localStorage.getItem(Rr(this,"gui"));l&&(r.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,rr.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),r.closeOnTop?(rr.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(rr.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),rr.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===r.closed&&(r.closed=!0);var u=document.createTextNode(r.name);rr.addClass(u,"controller-name"),s=kr(n,u);rr.addClass(this.__ul,e.CLASS_CLOSED),rr.addClass(s,"title"),rr.bind(s,"click",(function(e){return e.preventDefault(),n.closed=!n.closed,!1})),r.closed||(this.closed=!1)}r.autoPlace&&(Nn.isUndefined(r.parent)&&(Ar&&(Cr=document.createElement("div"),rr.addClass(Cr,"dg"),rr.addClass(Cr,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Cr),Ar=!1),Cr.appendChild(this.domElement),rr.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||Br(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},rr.bind(window,"resize",this.__resizeHandler),rr.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),rr.bind(this.__ul,"transitionend",this.__resizeHandler),rr.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&function(e){var t=void 0;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function r(){rr.removeClass(e.__closeButton,Pr.CLASS_DRAG),rr.unbind(window,"mousemove",n),rr.unbind(window,"mouseup",r)}function i(i){return i.preventDefault(),t=i.clientX,rr.addClass(e.__closeButton,Pr.CLASS_DRAG),rr.bind(window,"mousemove",n),rr.bind(window,"mouseup",r),!1}e.__resize_handle=document.createElement("div"),Nn.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),rr.bind(e.__resize_handle,"mousedown",i),rr.bind(e.__closeButton,"mousedown",i),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}(this),a=function(){wr&&"true"===localStorage.getItem(Rr(n,"isLocal"))&&localStorage.setItem(Rr(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=a,r.parent||((i=n.getRoot()).width+=1,Nn.defer((function(){i.width-=1})))};function kr(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,n):e.__ul.appendChild(r),e.onResize(),r}function Tr(e){rr.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&rr.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Or(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function Lr(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(-1!==r){var i=n.__rememberedObjectIndecesToControllers[r];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[t.property]=t,n.load&&n.load.remembered){var o=n.load.remembered,a=void 0;if(o[e.preset])a=o[e.preset];else{if(!o.Default)return;a=o.Default}if(a[r]&&void 0!==a[r][t.property]){var s=a[r][t.property];t.initialValue=s,t.setValue(s)}}}}function Ir(e,t,n,r){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var i=void 0;if(r.color)i=new hr(t,n);else{var o=[t,n].concat(r.factoryArgs);i=gr.apply(e,o)}r.before instanceof Jn&&(r.before=r.before.__li),Lr(e,i),rr.addClass(i.domElement,"c");var a=document.createElement("span");rr.addClass(a,"property-name"),a.innerHTML=i.property;var s=document.createElement("div");s.appendChild(a),s.appendChild(i.domElement);var l=kr(e,s,r.before);return rr.addClass(l,Pr.CLASS_CONTROLLER_ROW),i instanceof hr?rr.addClass(l,"color"):rr.addClass(l,Vn(i.getValue())),function(e,t,n){if(n.__li=t,n.__gui=e,Nn.extend(n,{options:function(t){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),Ir(e,n.object,n.property,{before:r,factoryArgs:[Nn.toArray(arguments)]})}if(Nn.isArray(t)||Nn.isObject(t)){var i=n.__li.nextElementSibling;return n.remove(),Ir(e,n.object,n.property,{before:i,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof dr){var r=new ur(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});Nn.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=n[e],i=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(r,e),t.apply(n,e)}})),rr.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof ur){var i=function(t){if(Nn.isNumber(n.__min)&&Nn.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,i=n.__gui.__listening.indexOf(n)>-1;n.remove();var o=Ir(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return o.name(r),i&&o.listen(),o}return t};n.min=Nn.compose(i,n.min),n.max=Nn.compose(i,n.max)}else n instanceof ir?(rr.bind(t,"click",(function(){rr.fakeEvent(n.__checkbox,"click")})),rr.bind(n.__checkbox,"click",(function(e){e.stopPropagation()}))):n instanceof fr?(rr.bind(t,"click",(function(){rr.fakeEvent(n.__button,"click")})),rr.bind(t,"mouseover",(function(){rr.addClass(n.__button,"hover")})),rr.bind(t,"mouseout",(function(){rr.removeClass(n.__button,"hover")}))):n instanceof hr&&(rr.addClass(t,"color"),n.updateDisplay=Nn.compose((function(e){return t.style.borderLeftColor=n.__color.toString(),e}),n.updateDisplay),n.updateDisplay());n.setValue=Nn.compose((function(t){return e.getRoot().__preset_select&&n.isModified()&&Or(e.getRoot(),!0),t}),n.setValue)}(e,l,i),e.__controllers.push(i),i}function Rr(e,t){return document.location.href+"."+t}function Dr(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function zr(e,t){t.style.display=e.useLocalStorage?"block":"none"}function Nr(e){var t=e.__save_row=document.createElement("li");rr.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),rr.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",rr.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",rr.addClass(r,"button"),rr.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",rr.addClass(i,"button"),rr.addClass(i,"save-as");var o=document.createElement("span");o.innerHTML="Revert",rr.addClass(o,"button"),rr.addClass(o,"revert");var a=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?Nn.each(e.load.remembered,(function(t,n){Dr(e,n,n===e.preset)})):Dr(e,xr,!1),rr.bind(a,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(a),t.appendChild(n),t.appendChild(r),t.appendChild(i),t.appendChild(o),wr){var s=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Rr(0,"isLocal"))&&l.setAttribute("checked","checked"),zr(e,s),rr.bind(l,"change",(function(){e.useLocalStorage=!e.useLocalStorage,zr(e,s)}))}var u=document.getElementById("dg-new-constructor");rr.bind(u,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Er.hide()})),rr.bind(n,"click",(function(){u.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),Er.show(),u.focus(),u.select()})),rr.bind(r,"click",(function(){e.save()})),rr.bind(i,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),rr.bind(o,"click",(function(){e.revert()}))}function Br(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function Mr(e,t){var n={};return Nn.each(e.__rememberedObjects,(function(r,i){var o={},a=e.__rememberedObjectIndecesToControllers[i];Nn.each(a,(function(e,n){o[n]=t?e.initialValue:e.getValue()})),n[i]=o})),n}function Ur(e){0!==e.length&&vr.call(window,(function(){Ur(e)})),Nn.each(e,(function(e){e.updateDisplay()}))}Pr.toggleHide=function(){Sr=!Sr,Nn.each(Fr,(function(e){e.domElement.style.display=Sr?"none":""}))},Pr.CLASS_AUTO_PLACE="a",Pr.CLASS_AUTO_PLACE_CONTAINER="ac",Pr.CLASS_MAIN="main",Pr.CLASS_CONTROLLER_ROW="cr",Pr.CLASS_TOO_TALL="taller-than-window",Pr.CLASS_CLOSED="closed",Pr.CLASS_CLOSE_BUTTON="close-button",Pr.CLASS_CLOSE_TOP="close-top",Pr.CLASS_CLOSE_BOTTOM="close-bottom",Pr.CLASS_DRAG="drag",Pr.DEFAULT_WIDTH=245,Pr.TEXT_CLOSED="Close Controls",Pr.TEXT_OPEN="Open Controls",Pr._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Pr.toggleHide()},rr.bind(window,"keydown",Pr._keydownHandler,!1),Nn.extend(Pr.prototype,{add:function(e,t){return Ir(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Ir(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;Nn.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Cr.removeChild(this.domElement);var e=this;Nn.each(this.__folders,(function(t){e.removeFolder(t)})),rr.unbind(window,"keydown",Pr._keydownHandler,!1),Tr(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new Pr(t);this.__folders[e]=n;var r=kr(this,n.domElement);return rr.addClass(r,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],Tr(e);var t=this;Nn.each(e.__folders,(function(t){e.removeFolder(t)})),Nn.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=rr.getOffset(e.__ul).top,n=0;Nn.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(n+=rr.getHeight(t))})),window.innerHeight-t-20<n?(rr.addClass(e.domElement,Pr.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(rr.removeClass(e.domElement,Pr.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&Nn.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:Nn.debounce((function(){this.onResize()}),50),remember:function(){if(Nn.isUndefined(Er)&&((Er=new yr).domElement.innerHTML=br),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;Nn.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&Nr(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&Br(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=Mr(this)),e.folders={},Nn.each(this.__folders,(function(t,n){e.folders[n]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Mr(this),Or(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=Mr(this,!0)),this.load.remembered[e]=Mr(this),this.preset=e,Dr(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){Nn.each(this.__controllers,(function(t){this.getRoot().load.remembered?Lr(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),Nn.each(this.__folders,(function(e){e.revert(e)})),e||Or(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&Ur(this.__listening)},updateDisplay:function(){Nn.each(this.__controllers,(function(e){e.updateDisplay()})),Nn.each(this.__folders,(function(e){e.updateDisplay()}))}});var jr=Pr;const Gr=document.getElementById("canvasgl"),Hr=function(e,t){const n=["webgl","experimental-webgl"];let r=null;for(let i=0;i<n.length;++i)if(r=e.getContext(n[i],t),r){kn.addExtensionsToContext&&In(r);break}return r}(Gr,{antialias:!0,depth:!1,preserveDrawingBuffer:!0});const Vr=[{format:Hr.RGBA,type:Hr.FLOAT,minMag:Hr.LINEAR,wrap:Hr.CLAMP_TO_EDGE}],Wr=1e3,qr=Wr;let Xr=3e3,Kr=Fn(Hr,Vr,Xr,Xr),Yr=Fn(Hr,Vr,Xr,Xr);const Qr=new jr;var Zr={};!function(t){"object"==typeof Zr?Zr=t():("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).GIF=t()}((function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var l=require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,(function(e){var n=t[a][1][e];return i(n||e)}),c,c.exports,e,t,n,r)}return n[a].exports}for(var o=require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,s,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(a(n=this._events[e]))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(o(n))for(s=Array.prototype.slice.call(arguments,1),r=(u=n.slice()).length,l=0;l<r;l++)u[l].apply(this,s);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var n,r,a,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=(n=this._events[e]).length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,n){var r,i,o,a,s;s=navigator.userAgent.toLowerCase(),a=navigator.platform.toLowerCase(),o="ie"===(r=s.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0])[1]&&document.documentMode,(i={name:"version"===r[1]?r[3]:r[1],version:o||parseFloat("opera"===r[1]&&r[4]?r[4]:r[2]),platform:{name:s.match(/ip(?:ad|od|hone)/)?"ios":(s.match(/(?:webos|android)/)||a.match(/mac|win|linux/)||["other"])[0]}})[i.name]=!0,i[i.name+parseInt(i.version,10)]=!0,i.platform[i.platform.name]=!0,t.exports=i},{}],3:[function(e,t,n){var r,i,o,a={}.hasOwnProperty,s=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},l=[].slice;r=e("events").EventEmitter,o=e("./browser.coffee"),i=function(e){var t,n;function r(e){var n,r,i;for(r in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(e),t)i=t[r],null==(n=this.options)[r]&&(n[r]=i)}return function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(r,e),t={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},n={delay:500,copy:!1},r.prototype.setOption=function(e,t){if(this.options[e]=t,null!=this._canvas&&("width"===e||"height"===e))return this._canvas[e]=t},r.prototype.setOptions=function(e){var t,n,r;for(t in n=[],e)a.call(e,t)&&(r=e[t],n.push(this.setOption(t,r)));return n},r.prototype.addFrame=function(e,t){var r,i;for(i in null==t&&(t={}),(r={}).transparent=this.options.transparent,n)r[i]=t[i]||n[i];if(null==this.options.width&&this.setOption("width",e.width),null==this.options.height&&this.setOption("height",e.height),"undefined"!=typeof ImageData&&null!==ImageData&&e instanceof ImageData)r.data=e.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!==WebGLRenderingContext&&e instanceof WebGLRenderingContext)t.copy?r.data=this.getContextData(e):r.context=e;else{if(null==e.childNodes)throw new Error("Invalid image");t.copy?r.data=this.getImageData(e):r.image=e}return this.frames.push(r)},r.prototype.render=function(){var e,t,n;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var e,t,n;for(n=[],e=0,t=this.frames.length;0<=t?e<t:e>t;0<=t?++e:--e)n.push(null);return n}.call(this),t=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(e=0,n=t;0<=n?e<n:e>n;0<=n?++e:--e)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},r.prototype.abort=function(){for(var e;null!=(e=this.activeWorkers.shift());)this.log("killing active worker"),e.terminate();return this.running=!1,this.emit("abort")},r.prototype.spawnWorkers=function(){var e,t,n,r;return e=Math.min(this.options.workers,this.frames.length),function(){n=[];for(var r=t=this.freeWorkers.length;t<=e?r<e:r>e;t<=e?r++:r--)n.push(r);return n}.apply(this).forEach((r=this,function(e){var t;return r.log("spawning worker "+e),(t=new Worker(r.options.workerScript)).onmessage=function(e){return r.activeWorkers.splice(r.activeWorkers.indexOf(t),1),r.freeWorkers.push(t),r.frameFinished(e.data)},r.freeWorkers.push(t)})),e},r.prototype.frameFinished=function(e){var t,n;if(this.log("frame "+e.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[e.index]=e,!0===this.options.globalPalette&&(this.options.globalPalette=e.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(t=1,n=this.freeWorkers.length;1<=n?t<n:t>n;1<=n?++t:--t)this.renderNextFrame();return s.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},r.prototype.finishRendering=function(){var e,t,n,r,i,o,a,s,l,u,c,d,f,h,p,m;for(s=0,i=0,l=(h=this.imageParts).length;i<l;i++)s+=((t=h[i]).data.length-1)*t.pageSize+t.cursor;for(s+=t.pageSize-t.cursor,this.log("rendering finished - filesize "+Math.round(s/1e3)+"kb"),e=new Uint8Array(s),d=0,o=0,u=(p=this.imageParts).length;o<u;o++)for(n=a=0,c=(m=(t=p[o]).data).length;a<c;n=++a)f=m[n],e.set(f,d),n===t.data.length-1?d+=t.cursor:d+=t.pageSize;return r=new Blob([e],{type:"image/gif"}),this.emit("finished",r,e)},r.prototype.renderNextFrame=function(){var e,t,n;if(0===this.freeWorkers.length)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return e=this.frames[this.nextFrame++],n=this.freeWorkers.shift(),t=this.getTask(e),this.log("starting frame "+(t.index+1)+" of "+this.frames.length),this.activeWorkers.push(n),n.postMessage(t)},r.prototype.getContextData=function(e){return e.getImageData(0,0,this.options.width,this.options.height).data},r.prototype.getImageData=function(e){var t;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(t=this._canvas.getContext("2d")).setFill=this.options.background,t.fillRect(0,0,this.options.width,this.options.height),t.drawImage(e,0,0),this.getContextData(t)},r.prototype.getTask=function(e){var t,n;if(n={index:t=this.frames.indexOf(e),last:t===this.frames.length-1,delay:e.delay,transparent:e.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===o.name},null!=e.data)n.data=e.data;else if(null!=e.context)n.data=this.getContextData(e.context);else{if(null==e.image)throw new Error("Invalid frame");n.data=this.getImageData(e.image)}return n},r.prototype.log=function(){var e;if(e=1<=arguments.length?l.call(arguments,0):[],this.options.debug)return console.log.apply(console,e)},r}(r),t.exports=i},{"./browser.coffee":2,events:1}]},{},[3])(3)}));let $r=Zr,Jr={FPS:25,loopDuration:10,size:512,isRecording:!1};Jr.numberOfFrames=Math.floor(Jr.FPS*Jr.loopDuration);var ei;try{ei=new Blob(['\n  (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module \'"+o+"\'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var NeuQuant=require("./TypedNeuQuant.js");var LZWEncoder=require("./LZWEncoder.js");function ByteArray(){this.page=-1;this.pages=[];this.newPage()}ByteArray.pageSize=4096;ByteArray.charMap={};for(var i=0;i<256;i++)ByteArray.charMap[i]=String.fromCharCode(i);ByteArray.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(ByteArray.pageSize);this.cursor=0};ByteArray.prototype.getData=function(){var rv="";for(var p=0;p<this.pages.length;p++){for(var i=0;i<ByteArray.pageSize;i++){rv+=ByteArray.charMap[this.pages[p][i]]}}return rv};ByteArray.prototype.writeByte=function(val){if(this.cursor>=ByteArray.pageSize)this.newPage();this.pages[this.page][this.cursor++]=val};ByteArray.prototype.writeUTFBytes=function(string){for(var l=string.length,i=0;i<l;i++)this.writeByte(string.charCodeAt(i))};ByteArray.prototype.writeBytes=function(array,offset,length){for(var l=length||array.length,i=offset||0;i<l;i++)this.writeByte(array[i])};function GIFEncoder(width,height){this.width=~~width;this.height=~~height;this.transparent=null;this.transIndex=0;this.repeat=-1;this.delay=0;this.image=null;this.pixels=null;this.indexedPixels=null;this.colorDepth=null;this.colorTab=null;this.neuQuant=null;this.usedEntry=new Array;this.palSize=7;this.dispose=-1;this.firstFrame=true;this.sample=10;this.dither=false;this.globalPalette=false;this.out=new ByteArray}GIFEncoder.prototype.setDelay=function(milliseconds){this.delay=Math.round(milliseconds/10)};GIFEncoder.prototype.setFrameRate=function(fps){this.delay=Math.round(100/fps)};GIFEncoder.prototype.setDispose=function(disposalCode){if(disposalCode>=0)this.dispose=disposalCode};GIFEncoder.prototype.setRepeat=function(repeat){this.repeat=repeat};GIFEncoder.prototype.setTransparent=function(color){this.transparent=color};GIFEncoder.prototype.addFrame=function(imageData){this.image=imageData;this.colorTab=this.globalPalette&&this.globalPalette.slice?this.globalPalette:null;this.getImagePixels();this.analyzePixels();if(this.globalPalette===true)this.globalPalette=this.colorTab;if(this.firstFrame){this.writeLSD();this.writePalette();if(this.repeat>=0){this.writeNetscapeExt()}}this.writeGraphicCtrlExt();this.writeImageDesc();if(!this.firstFrame&&!this.globalPalette)this.writePalette();this.writePixels();this.firstFrame=false};GIFEncoder.prototype.finish=function(){this.out.writeByte(59)};GIFEncoder.prototype.setQuality=function(quality){if(quality<1)quality=1;this.sample=quality};GIFEncoder.prototype.setDither=function(dither){if(dither===true)dither="FloydSteinberg";this.dither=dither};GIFEncoder.prototype.setGlobalPalette=function(palette){this.globalPalette=palette};GIFEncoder.prototype.getGlobalPalette=function(){return this.globalPalette&&this.globalPalette.slice&&this.globalPalette.slice(0)||this.globalPalette};GIFEncoder.prototype.writeHeader=function(){this.out.writeUTFBytes("GIF89a")};GIFEncoder.prototype.analyzePixels=function(){if(!this.colorTab){this.neuQuant=new NeuQuant(this.pixels,this.sample);this.neuQuant.buildColormap();this.colorTab=this.neuQuant.getColormap()}if(this.dither){this.ditherPixels(this.dither.replace("-serpentine",""),this.dither.match(/-serpentine/)!==null)}else{this.indexPixels()}this.pixels=null;this.colorDepth=8;this.palSize=7;if(this.transparent!==null){this.transIndex=this.findClosest(this.transparent,true)}};GIFEncoder.prototype.indexPixels=function(imgq){var nPix=this.pixels.length/3;this.indexedPixels=new Uint8Array(nPix);var k=0;for(var j=0;j<nPix;j++){var index=this.findClosestRGB(this.pixels[k++]&255,this.pixels[k++]&255,this.pixels[k++]&255);this.usedEntry[index]=true;this.indexedPixels[j]=index}};GIFEncoder.prototype.ditherPixels=function(kernel,serpentine){var kernels={FalseFloydSteinberg:[[3/8,1,0],[3/8,0,1],[2/8,1,1]],FloydSteinberg:[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],Stucki:[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],Atkinson:[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]]};if(!kernel||!kernels[kernel]){throw"Unknown dithering kernel: "+kernel}var ds=kernels[kernel];var index=0,height=this.height,width=this.width,data=this.pixels;var direction=serpentine?-1:1;this.indexedPixels=new Uint8Array(this.pixels.length/3);for(var y=0;y<height;y++){if(serpentine)direction=direction*-1;for(var x=direction==1?0:width-1,xend=direction==1?width:0;x!==xend;x+=direction){index=y*width+x;var idx=index*3;var r1=data[idx];var g1=data[idx+1];var b1=data[idx+2];idx=this.findClosestRGB(r1,g1,b1);this.usedEntry[idx]=true;this.indexedPixels[index]=idx;idx*=3;var r2=this.colorTab[idx];var g2=this.colorTab[idx+1];var b2=this.colorTab[idx+2];var er=r1-r2;var eg=g1-g2;var eb=b1-b2;for(var i=direction==1?0:ds.length-1,end=direction==1?ds.length:0;i!==end;i+=direction){var x1=ds[i][1];var y1=ds[i][2];if(x1+x>=0&&x1+x<width&&y1+y>=0&&y1+y<height){var d=ds[i][0];idx=index+x1+y1*width;idx*=3;data[idx]=Math.max(0,Math.min(255,data[idx]+er*d));data[idx+1]=Math.max(0,Math.min(255,data[idx+1]+eg*d));data[idx+2]=Math.max(0,Math.min(255,data[idx+2]+eb*d))}}}}};GIFEncoder.prototype.findClosest=function(c,used){return this.findClosestRGB((c&16711680)>>16,(c&65280)>>8,c&255,used)};GIFEncoder.prototype.findClosestRGB=function(r,g,b,used){if(this.colorTab===null)return-1;if(this.neuQuant&&!used){return this.neuQuant.lookupRGB(r,g,b)}var c=b|g<<8|r<<16;var minpos=0;var dmin=256*256*256;var len=this.colorTab.length;for(var i=0,index=0;i<len;index++){var dr=r-(this.colorTab[i++]&255);var dg=g-(this.colorTab[i++]&255);var db=b-(this.colorTab[i++]&255);var d=dr*dr+dg*dg+db*db;if((!used||this.usedEntry[index])&&d<dmin){dmin=d;minpos=index}}return minpos};GIFEncoder.prototype.getImagePixels=function(){var w=this.width;var h=this.height;this.pixels=new Uint8Array(w*h*3);var data=this.image;var srcPos=0;var count=0;for(var i=0;i<h;i++){for(var j=0;j<w;j++){this.pixels[count++]=data[srcPos++];this.pixels[count++]=data[srcPos++];this.pixels[count++]=data[srcPos++];srcPos++}}};GIFEncoder.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33);this.out.writeByte(249);this.out.writeByte(4);var transp,disp;if(this.transparent===null){transp=0;disp=0}else{transp=1;disp=2}if(this.dispose>=0){disp=dispose&7}disp<<=2;this.out.writeByte(0|disp|0|transp);this.writeShort(this.delay);this.out.writeByte(this.transIndex);this.out.writeByte(0)};GIFEncoder.prototype.writeImageDesc=function(){this.out.writeByte(44);this.writeShort(0);this.writeShort(0);this.writeShort(this.width);this.writeShort(this.height);if(this.firstFrame||this.globalPalette){this.out.writeByte(0)}else{this.out.writeByte(128|0|0|0|this.palSize)}};GIFEncoder.prototype.writeLSD=function(){this.writeShort(this.width);this.writeShort(this.height);this.out.writeByte(128|112|0|this.palSize);this.out.writeByte(0);this.out.writeByte(0)};GIFEncoder.prototype.writeNetscapeExt=function(){this.out.writeByte(33);this.out.writeByte(255);this.out.writeByte(11);this.out.writeUTFBytes("NETSCAPE2.0");this.out.writeByte(3);this.out.writeByte(1);this.writeShort(this.repeat);this.out.writeByte(0)};GIFEncoder.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);var n=3*256-this.colorTab.length;for(var i=0;i<n;i++)this.out.writeByte(0)};GIFEncoder.prototype.writeShort=function(pValue){this.out.writeByte(pValue&255);this.out.writeByte(pValue>>8&255)};GIFEncoder.prototype.writePixels=function(){var enc=new LZWEncoder(this.width,this.height,this.indexedPixels,this.colorDepth);enc.encode(this.out)};GIFEncoder.prototype.stream=function(){return this.out};module.exports=GIFEncoder},{"./LZWEncoder.js":2,"./TypedNeuQuant.js":3}],2:[function(require,module,exports){var EOF=-1;var BITS=12;var HSIZE=5003;var masks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function LZWEncoder(width,height,pixels,colorDepth){var initCodeSize=Math.max(2,colorDepth);var accum=new Uint8Array(256);var htab=new Int32Array(HSIZE);var codetab=new Int32Array(HSIZE);var cur_accum,cur_bits=0;var a_count;var free_ent=0;var maxcode;var clear_flg=false;var g_init_bits,ClearCode,EOFCode;function char_out(c,outs){accum[a_count++]=c;if(a_count>=254)flush_char(outs)}function cl_block(outs){cl_hash(HSIZE);free_ent=ClearCode+2;clear_flg=true;output(ClearCode,outs)}function cl_hash(hsize){for(var i=0;i<hsize;++i)htab[i]=-1}function compress(init_bits,outs){var fcode,c,i,ent,disp,hsize_reg,hshift;g_init_bits=init_bits;clear_flg=false;n_bits=g_init_bits;maxcode=MAXCODE(n_bits);ClearCode=1<<init_bits-1;EOFCode=ClearCode+1;free_ent=ClearCode+2;a_count=0;ent=nextPixel();hshift=0;for(fcode=HSIZE;fcode<65536;fcode*=2)++hshift;hshift=8-hshift;hsize_reg=HSIZE;cl_hash(hsize_reg);output(ClearCode,outs);outer_loop:while((c=nextPixel())!=EOF){fcode=(c<<BITS)+ent;i=c<<hshift^ent;if(htab[i]===fcode){ent=codetab[i];continue}else if(htab[i]>=0){disp=hsize_reg-i;if(i===0)disp=1;do{if((i-=disp)<0)i+=hsize_reg;if(htab[i]===fcode){ent=codetab[i];continue outer_loop}}while(htab[i]>=0)}output(ent,outs);ent=c;if(free_ent<1<<BITS){codetab[i]=free_ent++;htab[i]=fcode}else{cl_block(outs)}}output(ent,outs);output(EOFCode,outs)}function encode(outs){outs.writeByte(initCodeSize);remaining=width*height;curPixel=0;compress(initCodeSize+1,outs);outs.writeByte(0)}function flush_char(outs){if(a_count>0){outs.writeByte(a_count);outs.writeBytes(accum,0,a_count);a_count=0}}function MAXCODE(n_bits){return(1<<n_bits)-1}function nextPixel(){if(remaining===0)return EOF;--remaining;var pix=pixels[curPixel++];return pix&255}function output(code,outs){cur_accum&=masks[cur_bits];if(cur_bits>0)cur_accum|=code<<cur_bits;else cur_accum=code;cur_bits+=n_bits;while(cur_bits>=8){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}if(free_ent>maxcode||clear_flg){if(clear_flg){maxcode=MAXCODE(n_bits=g_init_bits);clear_flg=false}else{++n_bits;if(n_bits==BITS)maxcode=1<<BITS;else maxcode=MAXCODE(n_bits)}}if(code==EOFCode){while(cur_bits>0){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}flush_char(outs)}}this.encode=encode}module.exports=LZWEncoder},{}],3:[function(require,module,exports){var ncycles=100;var netsize=256;var maxnetpos=netsize-1;var netbiasshift=4;var intbiasshift=16;var intbias=1<<intbiasshift;var gammashift=10;var gamma=1<<gammashift;var betashift=10;var beta=intbias>>betashift;var betagamma=intbias<<gammashift-betashift;var initrad=netsize>>3;var radiusbiasshift=6;var radiusbias=1<<radiusbiasshift;var initradius=initrad*radiusbias;var radiusdec=30;var alphabiasshift=10;var initalpha=1<<alphabiasshift;var alphadec;var radbiasshift=8;var radbias=1<<radbiasshift;var alpharadbshift=alphabiasshift+radbiasshift;var alpharadbias=1<<alpharadbshift;var prime1=499;var prime2=491;var prime3=487;var prime4=503;var minpicturebytes=3*prime4;function NeuQuant(pixels,samplefac){var network;var netindex;var bias;var freq;var radpower;function init(){network=[];netindex=new Int32Array(256);bias=new Int32Array(netsize);freq=new Int32Array(netsize);radpower=new Int32Array(netsize>>3);var i,v;for(i=0;i<netsize;i++){v=(i<<netbiasshift+8)/netsize;network[i]=new Float64Array([v,v,v,0]);freq[i]=intbias/netsize;bias[i]=0}}function unbiasnet(){for(var i=0;i<netsize;i++){network[i][0]>>=netbiasshift;network[i][1]>>=netbiasshift;network[i][2]>>=netbiasshift;network[i][3]=i}}function altersingle(alpha,i,b,g,r){network[i][0]-=alpha*(network[i][0]-b)/initalpha;network[i][1]-=alpha*(network[i][1]-g)/initalpha;network[i][2]-=alpha*(network[i][2]-r)/initalpha}function alterneigh(radius,i,b,g,r){var lo=Math.abs(i-radius);var hi=Math.min(i+radius,netsize);var j=i+1;var k=i-1;var m=1;var p,a;while(j<hi||k>lo){a=radpower[m++];if(j<hi){p=network[j++];p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}if(k>lo){p=network[k--];p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}}}function contest(b,g,r){var bestd=~(1<<31);var bestbiasd=bestd;var bestpos=-1;var bestbiaspos=bestpos;var i,n,dist,biasdist,betafreq;for(i=0;i<netsize;i++){n=network[i];dist=Math.abs(n[0]-b)+Math.abs(n[1]-g)+Math.abs(n[2]-r);if(dist<bestd){bestd=dist;bestpos=i}biasdist=dist-(bias[i]>>intbiasshift-netbiasshift);if(biasdist<bestbiasd){bestbiasd=biasdist;bestbiaspos=i}betafreq=freq[i]>>betashift;freq[i]-=betafreq;bias[i]+=betafreq<<gammashift}freq[bestpos]+=beta;bias[bestpos]-=betagamma;return bestbiaspos}function inxbuild(){var i,j,p,q,smallpos,smallval,previouscol=0,startpos=0;for(i=0;i<netsize;i++){p=network[i];smallpos=i;smallval=p[1];for(j=i+1;j<netsize;j++){q=network[j];if(q[1]<smallval){smallpos=j;smallval=q[1]}}q=network[smallpos];if(i!=smallpos){j=q[0];q[0]=p[0];p[0]=j;j=q[1];q[1]=p[1];p[1]=j;j=q[2];q[2]=p[2];p[2]=j;j=q[3];q[3]=p[3];p[3]=j}if(smallval!=previouscol){netindex[previouscol]=startpos+i>>1;for(j=previouscol+1;j<smallval;j++)netindex[j]=i;previouscol=smallval;startpos=i}}netindex[previouscol]=startpos+maxnetpos>>1;for(j=previouscol+1;j<256;j++)netindex[j]=maxnetpos}function inxsearch(b,g,r){var a,p,dist;var bestd=1e3;var best=-1;var i=netindex[g];var j=i-1;while(i<netsize||j>=0){if(i<netsize){p=network[i];dist=p[1]-g;if(dist>=bestd)i=netsize;else{i++;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}if(j>=0){p=network[j];dist=g-p[1];if(dist>=bestd)j=-1;else{j--;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}}return best}function learn(){var i;var lengthcount=pixels.length;var alphadec=30+(samplefac-1)/3;var samplepixels=lengthcount/(3*samplefac);var delta=~~(samplepixels/ncycles);var alpha=initalpha;var radius=initradius;var rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(i=0;i<rad;i++)radpower[i]=alpha*((rad*rad-i*i)*radbias/(rad*rad));var step;if(lengthcount<minpicturebytes){samplefac=1;step=3}else if(lengthcount%prime1!==0){step=3*prime1}else if(lengthcount%prime2!==0){step=3*prime2}else if(lengthcount%prime3!==0){step=3*prime3}else{step=3*prime4}var b,g,r,j;var pix=0;i=0;while(i<samplepixels){b=(pixels[pix]&255)<<netbiasshift;g=(pixels[pix+1]&255)<<netbiasshift;r=(pixels[pix+2]&255)<<netbiasshift;j=contest(b,g,r);altersingle(alpha,j,b,g,r);if(rad!==0)alterneigh(rad,j,b,g,r);pix+=step;if(pix>=lengthcount)pix-=lengthcount;i++;if(delta===0)delta=1;if(i%delta===0){alpha-=alpha/alphadec;radius-=radius/radiusdec;rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(j=0;j<rad;j++)radpower[j]=alpha*((rad*rad-j*j)*radbias/(rad*rad))}}}function buildColormap(){init();learn();unbiasnet();inxbuild()}this.buildColormap=buildColormap;function getColormap(){var map=[];var index=[];for(var i=0;i<netsize;i++)index[network[i][3]]=i;var k=0;for(var l=0;l<netsize;l++){var j=index[l];map[k++]=network[j][0];map[k++]=network[j][1];map[k++]=network[j][2]}return map}this.getColormap=getColormap;this.lookupRGB=inxsearch}module.exports=NeuQuant},{}],4:[function(require,module,exports){var GIFEncoder,renderFrame;GIFEncoder=require("./GIFEncoder.js");renderFrame=function(frame){var encoder,page,stream,transfer;encoder=new GIFEncoder(frame.width,frame.height);if(frame.index===0){encoder.writeHeader()}else{encoder.firstFrame=false}encoder.setTransparent(frame.transparent);encoder.setRepeat(frame.repeat);encoder.setDelay(frame.delay);encoder.setQuality(frame.quality);encoder.setDither(frame.dither);encoder.setGlobalPalette(frame.globalPalette);encoder.addFrame(frame.data);if(frame.last){encoder.finish()}if(frame.globalPalette===true){frame.globalPalette=encoder.getGlobalPalette()}stream=encoder.stream();frame.data=stream.pages;frame.cursor=stream.cursor;frame.pageSize=stream.constructor.pageSize;if(frame.canTransfer){transfer=function(){var i,len,ref,results;ref=frame.data;results=[];for(i=0,len=ref.length;i<len;i++){page=ref[i];results.push(page.buffer)}return results}();return self.postMessage(frame,transfer)}else{return self.postMessage(frame)}};self.onmessage=function(event){return renderFrame(event.data)}},{"./GIFEncoder.js":1}]},{},[4]);\n  '],{type:"application/javascript"})}catch(e){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(ei=new BlobBuilder).append(response),ei=ei.getBlob()}var ti=new $r({workers:2,workerScript:URL.createObjectURL(ei),quality:1}),ni={LOOKUP_DIST:.1,LOOKUP_ANGLE:.1,TURN_ANGLE:.1,ANGLE_SPREAD:.1,STEP_SIZE:.1,DECAY:.5,DIFFUSE_RADIUS:2,DEPOSITE:.001,LIGHTNESS:100,REPULSION:100,RESPAWN_P:.001,DIFFUSE_RADIUS:1,FRICTION:.1,RES:1e3,record:function(){Jr.isRecording?(Jr.isRecording=!1,ti.render()):Jr.isRecording=!0},randomize:function(){Qr.__controllers.forEach((e=>{console.log(e.property),"NumberControllerSlider"==e.constructor.name&&"LIGHTNESS"!=e.property&&e.setValue(e.__min+Math.random()*(e.__max-e.__min))}))}};Qr.remember(ni);Qr.add(ni,"LOOKUP_DIST").min(0).max(.1).step(1e-4);Qr.add(ni,"STEP_SIZE").min(1e-5).max(.1).step(1e-4),Qr.add(ni,"FRICTION").min(0).max(.9999).step(1e-4),Qr.add(ni,"LOOKUP_ANGLE").min(0).max(2*Math.PI).step(.001),Qr.add(ni,"TURN_ANGLE").min(0).max(2*Math.PI).step(.001),Qr.add(ni,"ANGLE_SPREAD").min(0).max(Math.PI).step(.001),Qr.add(ni,"DEPOSITE").min(0).max(1e-5).step(1e-8),Qr.add(ni,"DECAY").min(0).max(1).step(.001),Qr.add(ni,"REPULSION").min(0).max(1e5).step(1e-6),Qr.add(ni,"RES").min(2).max(3e3).step(1).onFinishChange((function(){Xr=this.getValue(),Kr=Fn(Hr,Vr,Xr,Xr),Yr=Fn(Hr,Vr,Xr,Xr)})),Qr.add(ni,"RESPAWN_P").min(0).max(.1).step(1e-6),Qr.add(ni,"LIGHTNESS").min(1).max(1e3).step(1),Qr.add(ni,"record"),Qr.add(ni,"randomize");const ri=[0,0];const ii="precision highp float;\n#define GLSLIFY 1\nattribute vec2 position;\nvarying vec2 v_position;\nvarying float v_id; // for physics only\nvarying float v_mass; // for physics only\n\nvoid main() {\n    v_position = .5 * position + .5;\n    gl_Position = vec4(position, 0.0, 1.0);\n}";In(Hr),Hr.getExtension("OES_texture_float"),Hr.getExtension("WEBGL_color_buffer_float");const oi=_n(Hr,[ii,"precision highp float;\n#define GLSLIFY 1\n\nvarying vec2 v_position;\nvarying float v_id; // похоже, тут никак этого не получить. Разве что вычислять из координат пикселя. Но для этого надо знать разрешение текстуры.\n// varying float v_mass;\nuniform sampler2D u_tex_fbo;\nuniform sampler2D u_tex_draw;\nuniform vec2 u_tex_draw_res;\nuniform float u_time;\nuniform float u_tick;\nuniform vec2 u_resolution;\nuniform vec2 u_mouse;\n\nmat2 rot(float a) {\n  float s = sin(a), c = cos(a);\n  return mat2(c, -s, s, c);\n}\n\nhighp float random(vec2 co)\n{\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\n//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289_1(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289_1(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute_1(vec3 x) {\n  return mod289_1(((x*34.0)+1.0)*x);\n}\n\nfloat snoise_1(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289_1(i); // Avoid truncation effects in permutation\n  vec3 p = permute_1( permute_1( i.y + vec3(0.0, i1.y, 1.0 ))\n    + i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289_0(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289_0(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute_0(vec4 x) {\n     return mod289_0(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise_0(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g_0 = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g_0;\n  vec3 i1 = min( g_0.xyz, l.zxy );\n  vec3 i2 = max( g_0.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289_0(i);\n  vec4 p = permute_0( permute_0( permute_0(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\nfloat rnd(float x) {\n  return random(vec2(x * .0001));\n}\n\nuniform float LOOKUP_DIST;\n#define LOOKUP_DIST_CENTER LOOKUP_DIST * 1.\nuniform float LOOKUP_ANGLE;\nuniform float TURN_ANGLE;\nuniform float STEP_SIZE;\nuniform float SENCE_MIN;\nuniform float SENCE_MAX;\n// uniform float SENSE_ADD;\n#define SENSE_ADD .0\nuniform float RESPAWN_P;\nuniform float FRICTION;\nuniform float REPULSION;\nuniform float ANGLE_SPREAD;\n\nvec2 turn(vec2 pos, vec2 vel) {\n\n  vec2 uv = pos * .5 + .5;// + vec2(1, 0) / u_tex_draw_res);\n  vec2 sensorL = uv + (rot(-LOOKUP_ANGLE) * normalize(vel)) * LOOKUP_DIST;\n  vec2 sensorC = uv + normalize(vel) * LOOKUP_DIST_CENTER;\n  vec2 sensorR = uv + (rot(LOOKUP_ANGLE) * normalize(vel)) * LOOKUP_DIST;\n  vec2 sensor0 = uv;\n\n  float senseL = texture2D(u_tex_draw, sensorL).r;\n  senseL = clamp(senseL, SENCE_MIN, SENCE_MAX);\n  float senseC = texture2D(u_tex_draw, sensorC).r;\n  senseC = clamp(senseC, SENCE_MIN, SENCE_MAX);\n  float senseR = texture2D(u_tex_draw, sensorR).r;\n  senseR = clamp(senseR, SENCE_MIN, SENCE_MAX);\n  float sense0 = texture2D(u_tex_draw, sensor0).r;\n\n float turn_angle_rnd = TURN_ANGLE + ANGLE_SPREAD*(rnd(length(pos))*2.-1.);\n\n// stadard\n  if(senseC > senseL && senseC > senseR)\n    return vel * senseC;\n  if(senseL == senseR) {\n    vel *= (senseR + SENSE_ADD) * rot(sign(rnd(vel.x) - .5) * (turn_angle_rnd));\n  } else if(senseL < senseR) {\n    vel *= (senseR + SENSE_ADD) * rot(-turn_angle_rnd);\n  } else if(senseL > senseR) {\n    vel *= (senseL + SENSE_ADD) * rot(turn_angle_rnd);\n  }\n\n  // // middle way\n  // if((senseC > senseL && senseC < senseR) || (senseC < senseL && senseC > senseR))\n  //   return vel;\n  // if(senseL == senseR) {\n  //     vel *= rot(sign(rnd(vel.x)-.5) * TURN_ANGLE);\n  // } else if(senseL > senseR) {\n  //   vel *= rot(-TURN_ANGLE);\n  // } else if(senseL < senseR) {\n  //   vel *= rot(TURN_ANGLE);\n  // }\n\n  // if(sense0 > senseC && sense0 > senseR && sense0 > senseL)\n  //   return vel;\n  // if(senseC > senseL && senseC > senseR) {\n  //     vel += normalize(vel) * 10. * u_mouse.x * (senseC - sense0);\n  // } else if(senseL < senseR) {\n  //     vel += normalize(vel) * 10. * u_mouse.x * rot(-LOOKUP_ANGLE) * (senseR - sense0);\n  // } else if(senseL > senseR) {\n  //     vel += normalize(vel) * 10. * u_mouse.x * rot(LOOKUP_ANGLE)* (senseL - sense0);\n  // }\n  return vel;\n}\n\nvec2 grad(vec2 pos) {\n  vec2 gr;\n  gr.x = texture2D(u_tex_draw, fract(pos * .5 + .5 + vec2(LOOKUP_DIST, 0) / u_tex_draw_res)).r -\n    texture2D(u_tex_draw, fract(pos * .5 + .5 - vec2(LOOKUP_DIST, 0) / u_tex_draw_res)).r;\n  gr.y = texture2D(u_tex_draw, fract(pos * .5 + .5 + vec2(0, LOOKUP_DIST) / u_tex_draw_res)).r -\n    texture2D(u_tex_draw, fract(pos * .5 + .5 - vec2(0, LOOKUP_DIST) / u_tex_draw_res)).r;\n  return gr;\n}\n\nvoid main() {\n  float id = (floor(gl_FragCoord.x) + floor(gl_FragCoord.y) * u_resolution.x) * .0001;\n\n  vec4 particle = texture2D(u_tex_fbo, v_position);\n  vec2 pos = particle.xy;\n  vec2 vel = particle.zw;\n  float mass = rnd(id);\n\n  // init\n  if(rnd(id + u_time) < RESPAWN_P || u_tick < 2.) {\n    // gl_FragColor.r = (rnd(id + 1. + u_time * .001 + length(pos)) * 2. - 1.);\n    // gl_FragColor.g = (rnd(id + 2. + u_time * .001 + length(pos)) * 2. - 1.);\n    float angle = rnd(id + u_time * .001 + length(pos)) * 2. * 3.1415;\n    gl_FragColor.rg = vec2(.2, 0) * rot(angle);\n    gl_FragColor.ba = vec2(.0001, 0) * STEP_SIZE * rot(rnd(id) * 2. * 3.1415);\n  }\n\n  // physics\n  else {\n    // // force\n    vel *= 1. - FRICTION;\n    // vel = normalize(vel);\n\n    // vel.x += .01 * snoise3d(u_mouse.x + vec3(u_time * .001, pos * 10.));\n    // vel.y += .01 * snoise3d(u_mouse.y + vec3(u_time * .001, pos * 10. + 99.));\n    // vel.x += .002 * snoise2d(pos * 32. + u_mouse.x);\n    // vel.y += .002 * snoise2d(pos * 32. + u_mouse.x + 99.);\n  //  vel += vec2(-.001,0) * rot(atan(pos.y, pos.x));\n\n  // spinning\n    // vel += vec2(0, -.0005) * rot(atan(pos.y, pos.x));\n\n    vel += turn(pos, normalize(vel)) * STEP_SIZE * 10000.;// * 1.001;\n\n    vel -= REPULSION * grad(pos);\n\n    // vec2 vecToCenter = u_mouse - pos;\n    // float repulsion = 1. / length(vecToCenter);\n    // vel -= sign(rnd(id) - .9) * repulsion * vec2(.0001, 0) * rot(atan(vecToCenter.y, vecToCenter.x));\n\n    pos += vel;// / mass;\n    pos = fract(pos * .5 + .5) * 2. - 1.;\n    if(length(pos) > .9) {\n      pos = normalize(pos) * .9;\n      vec2 n=normalize(vec2(pos));\n      vel = reflect(vel, -n);\n    }\n\n    gl_FragColor = vec4(pos, vel);\n  }\n}"]),ai=_n(Hr,["precision highp float;\n#define GLSLIFY 1\n\nattribute vec2 v_position;\nattribute float v_mass;\nattribute float v_id;\nuniform sampler2D u_tex_fbo;\nuniform float u_time;\nuniform vec2 u_resolution;\nvarying vec4 color;\nvarying vec2 position;\n\nuniform float DEPOSITE;\n\n// #define rnd(x) fract(54321.987 * sin(987.12345 * x))\n//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n    + i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\nvoid main() {\n  vec4 particle = texture2D(u_tex_fbo, v_position); // v_position делаем вручную в JS\n  // vec2 pos = fract(particle.xy) * 2. - 1.;\n  vec2 pos = particle.xy;\n\n  // Этот партиклес.ху почему-то конский. Я ожидаю, что там будет что-то около .5, а там сотни единиц\n  // if(length(particle.xy)>200.5) pos = vec2(999);\n\n  vec2 vel = particle.zw;\n  float resMin = min(u_resolution.y, u_resolution.x);\n  gl_Position = vec4(pos.x  / resMin * u_resolution.y, pos.y / resMin * u_resolution.x, 0, 1);\n  // gl_Position = vec4(pos, 0, 1);\n\n    // а тут вместо в_масс, который приходит из буфера, заюзаем хак, массу вычисленную из координат ФБО\n    // потому что лень как-то передавать её через JS, через текстуру\n  // float mass = rnd(length(v_position));\n  gl_PointSize = 1.;\n\n    // color = mix(vec4(0.,0.,0.,1.), vec4(0.7333333333333333,0.7333333333333333,0.7333333333333333,1.), length(vel.y*500.));\n  // color.r = snoise2d((floor(pos * 2.)) + 1. + u_time * .1);\n  // color.g = snoise2d((floor(pos * 2.)) + 2. + u_time * .1);\n  // color.b = snoise2d((floor(pos * 2.)) + 3. + u_time * .1);\n \n  // color.a = clamp(1. / u_time, 0., 1.);\n  // color.a = (.5 + .5 * sin(u_time * 1.));// * u_time / exp(u_time);// / u_time;\n  color.rgb = vec3(DEPOSITE);\n  color.a = 1.;\n\n  position = pos;\n}","precision highp float;\n#define GLSLIFY 1\nvarying vec4 color;\nuniform float u_time;\nuniform sampler2D u_tex_draw;\nvarying vec2 position; // координаты партикла, приходит из pos\nuniform vec2 u_resolution;\n\nvoid main() {\n  // vec2 uv = gl_FragCoord.xy / u_resolution; // координаты текущего пикселя буфера Дроу\n  // vec4 colorPrev = texture2D(u_tex_draw, uv);\n  // gl_FragColor = colorPrev * color;\n  gl_FragColor = color;\n  // gl_FragColor = vec4(0,0,0, min(colorPrev.a + color.a, 1.));//min(colorPrev, color);\n  // gl_FragColor = vec4(0,0,0,1);\n}"]),si=_n(Hr,[ii,"precision mediump float;\n#define GLSLIFY 1\nuniform float u_tick;\n\nvoid main() {\n    if(u_tick <= .2) {\n        gl_FragColor = vec4(0,0,0,1);\n    } else {\n        gl_FragColor = vec4(.0);\n    }\n}"]),li=_n(Hr,[ii,"precision mediump float;\n#define GLSLIFY 1\n// varying vec2 v_position;\nuniform sampler2D u_tex_draw;\nuniform vec2 u_resolution;\nuniform float DECAY;\nuniform float DIFFUSE_RADIUS;\n#define DIFFUSE_RADIUS_MAX  10\n\nvoid main() {\n    vec4 val = vec4(0);\n\n//     vec2 R = vec2(0, 1);\n//     val += texture2D(u_tex_draw, gl_FragCoord.xy / u_resolution);\n//     val += texture2D(u_tex_draw, fract((gl_FragCoord.xy + R.xy) / u_resolution)) / 2.;\n//     val += texture2D(u_tex_draw, fract((gl_FragCoord.xy + R.yx) / u_resolution)) / 2.;\n//     val += texture2D(u_tex_draw, fract((gl_FragCoord.xy - R.xy) / u_resolution)) / 2.;\n//     val += texture2D(u_tex_draw, fract((gl_FragCoord.xy - R.yx) / u_resolution)) / 2.;\n//     val /= 3.;\n//    gl_FragColor = val * DECAY;\n\n    float k_sum = 0.;\n    for(int i = -DIFFUSE_RADIUS_MAX; i <= DIFFUSE_RADIUS_MAX; i++) {\n        if(abs(float(i)) > DIFFUSE_RADIUS)\n            continue;\n        for(int j = -DIFFUSE_RADIUS_MAX; j <= DIFFUSE_RADIUS_MAX; j++) {\n            if(abs(float(j)) > DIFFUSE_RADIUS)\n                continue;\n            vec2 ij = vec2(i, j);\n            // float k = 1./(length(ij)+1.);\n            float k = 1.;//(length(ij)+1.);\n            val += k * texture2D(u_tex_draw, fract((gl_FragCoord.xy - ij) / u_resolution));\n            k_sum += k;\n        }\n    }\n    gl_FragColor = val / k_sum * DECAY;\n    // gl_FragColor *= smoothstep(1., .9, length((gl_FragCoord.xy * 2. - u_resolution) / u_resolution));\n}"]),ui=_n(Hr,[ii,"precision mediump float;\n#define GLSLIFY 1\n// varying vec2 v_position;\nuniform sampler2D u_tex_draw;\n// uniform float u_tick;\nuniform vec2 u_resolution;\nuniform float LIGHTNESS;\n\nvoid main() {\n    gl_FragColor.rgb = LIGHTNESS * pow(texture2D(u_tex_draw, gl_FragCoord.xy / u_resolution).rgb,vec3(.3));\n    // gl_FragColor.rgb = pow(gl_FragColor.rgb, vec3(.5));\n    gl_FragColor.a = 1.;\n    // gl_FragColor = vec4(1.,0.,1.,1.);\n}"]);let ci=Fn(Hr,Vr,Wr,qr),di=Fn(Hr,Vr,Wr,qr);const fi=[],hi=[],pi=[];for(let e=0;e<Wr;e++)for(let t=0;t<qr;t++)fi.push(e*Wr+t),hi.push(e/Wr+5e-4),hi.push(t/qr+5e-4),pi.push(5*Math.random());const mi=M(Hr,{v_id:{data:fi,numComponents:1},v_position:{data:hi,numComponents:2},v_mass:{data:pi,numComponents:1}}),_i=M(Hr,{position:{data:[1,1,1,-1,-1,-1,-1,1],numComponents:2}});let bi,gi=0,vi=new Date/1e3;function yi(e){e=new Date/1e3-vi,function(e,t){t=t||1,t=Math.max(0,t);const n=e.clientWidth*t|0,r=e.clientHeight*t|0;(e.width!==n||e.height!==r)&&(e.width=n,e.height=r)}(Hr.canvas),Hr.viewport(0,0,Hr.canvas.width,Hr.canvas.height),Hr.blendFunc(Hr.ONE,Hr.ZERO),Hr.useProgram(li.program),pn(Hr,li,_i),dn(li,{u_tex_draw:Yr.attachments[0],u_resolution:[Xr,Xr],DECAY:ni.DECAY,DIFFUSE_RADIUS:ni.DIFFUSE_RADIUS}),Pn(Hr,Kr),bn(Hr,_i,Hr.TRIANGLE_FAN),bi=ci,ci=di,di=bi,Hr.blendFunc(Hr.ONE,Hr.ZERO),Hr.useProgram(oi.program),pn(Hr,oi,_i),dn(oi,{u_tex_fbo:ci.attachments[0],u_tex_draw:Yr.attachments[0],u_tex_draw_res:[Xr,Xr],u_tick:gi,u_time:e,u_mouse:ri,u_resolution:[Wr,qr],LOOKUP_DIST:ni.LOOKUP_DIST,LOOKUP_ANGLE:ni.LOOKUP_ANGLE,ANGLE_SPREAD:ni.ANGLE_SPREAD,TURN_ANGLE:ni.TURN_ANGLE,STEP_SIZE:ni.STEP_SIZE,SENCE_MIN:ni.SENCE_MIN,SENCE_MAX:ni.SENCE_MAX,SENSE_ADD:ni.SENSE_ADD,RESPAWN_P:ni.RESPAWN_P,FRICTION:ni.FRICTION,REPULSION:ni.REPULSION}),Pn(Hr,di),bn(Hr,_i,Hr.TRIANGLE_FAN),Hr.blendFunc(Hr.ONE,Hr.ONE),Hr.useProgram(ai.program),pn(Hr,ai,mi),dn(ai,{u_tex_fbo:di.attachments[0],u_time:e,u_resolution:[Xr,Xr],DEPOSITE:1e6*ni.DEPOSITE/Xr/Xr}),Pn(Hr,Kr),bn(Hr,mi,Hr.POINTS),Hr.blendFunc(Hr.ONE,Hr.ZERO),Hr.useProgram(ui.program),pn(Hr,ui,_i),dn(ui,{u_tex_draw:Kr.attachments[0],u_resolution:[Hr.canvas.width,Hr.canvas.height],LIGHTNESS:ni.LIGHTNESS}),Pn(Hr,null),bn(Hr,_i,Hr.TRIANGLE_FAN),bi=Kr,Kr=Yr,Yr=bi,gi++}function xi(e){ri[0]=e.clientX/Hr.canvas.clientWidth*2-1,ri[1]=2*(1-e.clientY/Hr.canvas.clientHeight)-1}function wi(e){e.preventDefault(),xi(e.touches[0])}Hr.blendFunc(Hr.ONE,Hr.ZERO),Hr.useProgram(si.program),pn(Hr,si,_i),dn(si,{u_tick:gi}),Pn(Hr,Kr),bn(Hr,_i,Hr.TRIANGLE_FAN),Hr.blendFunc(Hr.ONE,Hr.ZERO),Hr.useProgram(si.program),pn(Hr,si,_i),dn(si,{u_tick:gi}),Pn(Hr,Yr),bn(Hr,_i,Hr.TRIANGLE_FAN),Hr.enable(Hr.BLEND),ti.on("finished",(function(e){window.open(URL.createObjectURL(e)),Jr.isRecording=!1})),function e(t){yi(),requestAnimationFrame(e),Jr.isRecording&&(console.log("tick",gi),ti.addFrame(Gr,{copy:!0,delay:1e3/Jr.FPS}))}(),Gr.addEventListener("mousemove",xi),Gr.addEventListener("touchstart",wi,{passive:!1}),Gr.addEventListener("touchmove",wi,{passive:!1})}();